{"name": "modules_lux_extensions_sessions_backend", "html": {"main": "<section id=\"page-header\" class=\"page-header-outer modules_lux_extensions_sessions_backend-header\">\n    <div class=\"layer\">\n        <div class=\"page-header\">\n            <div class=\"container fullpage\">\n                <div class=\"row fullpage\">\n                    <div class=\"col-sm-12 text-center\">\n                        <breadcrumbs></breadcrumbs>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</section>\n\n<div id=\"page-main\">\n    <div class=\"container\">\n        <div class=\"row\">\n            <div class=\"modules_lux_extensions_sessions_backend-main col-md-12\">\n                <div class=\"center-block\" style=\"max-width: 900px\" data-highlight data-hash-scroll>\n                    <h1>Source code for lux.extensions.sessions.backend</h1><div class=\"highlight\"><pre>\n<span class=\"kn\">from</span> <span class=\"nn\">importlib</span> <span class=\"kn\">import</span> <span class=\"n\">import_module</span>\n<span class=\"kn\">from</span> <span class=\"nn\">datetime</span> <span class=\"kn\">import</span> <span class=\"n\">datetime</span><span class=\"p\">,</span> <span class=\"n\">timedelta</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">pulsar</span> <span class=\"kn\">import</span> <span class=\"n\">PermissionDenied</span><span class=\"p\">,</span> <span class=\"n\">Http404</span>\n<span class=\"kn\">from</span> <span class=\"nn\">pulsar.utils.pep</span> <span class=\"kn\">import</span> <span class=\"n\">to_bytes</span><span class=\"p\">,</span> <span class=\"n\">to_string</span>\n<span class=\"kn\">from</span> <span class=\"nn\">pulsar.utils.importer</span> <span class=\"kn\">import</span> <span class=\"n\">module_attribute</span>\n\n<span class=\"kn\">import</span> <span class=\"nn\">lux</span>\n<span class=\"kn\">from</span> <span class=\"nn\">lux</span> <span class=\"kn\">import</span> <span class=\"n\">Parameter</span>\n<span class=\"kn\">from</span> <span class=\"nn\">lux.utils.crypt</span> <span class=\"kn\">import</span> <span class=\"n\">get_random_string</span><span class=\"p\">,</span> <span class=\"n\">digest</span>\n\n\n<span class=\"n\">__all__</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"s\">&#39;AuthBackend&#39;</span><span class=\"p\">,</span> <span class=\"s\">&#39;AuthenticationError&#39;</span><span class=\"p\">,</span> <span class=\"s\">&#39;LoginError&#39;</span><span class=\"p\">,</span> <span class=\"s\">&#39;LogoutError&#39;</span><span class=\"p\">,</span>\n           <span class=\"s\">&#39;SessionMixin&#39;</span><span class=\"p\">,</span> <span class=\"s\">&#39;UserMixin&#39;</span><span class=\"p\">,</span> <span class=\"s\">&#39;Anonymous&#39;</span><span class=\"p\">]</span>\n\n\n<span class=\"n\">UNUSABLE_PASSWORD</span> <span class=\"o\">=</span> <span class=\"s\">&#39;!&#39;</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">AuthenticationError</span><span class=\"p\">(</span><span class=\"ne\">ValueError</span><span class=\"p\">):</span>\n    <span class=\"k\">pass</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">LoginError</span><span class=\"p\">(</span><span class=\"ne\">RuntimeError</span><span class=\"p\">):</span>\n    <span class=\"k\">pass</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">LogoutError</span><span class=\"p\">(</span><span class=\"ne\">RuntimeError</span><span class=\"p\">):</span>\n    <span class=\"k\">pass</span>\n\n\n<div class=\"viewcode-block\" id=\"SessionMixin\"><a class=\"viewcode-back\" href=\"../../../../api/sessions#lux.extensions.sessions.backend.SessionMixin\">[docs]</a><span class=\"k\">class</span> <span class=\"nc\">SessionMixin</span><span class=\"p\">(</span><span class=\"nb\">object</span><span class=\"p\">):</span>\n    <span class=\"sd\">&#39;&#39;&#39;Mixin for a session class</span>\n<span class=\"sd\">    &#39;&#39;&#39;</span>\n<div class=\"viewcode-block\" id=\"SessionMixin.success\"><a class=\"viewcode-back\" href=\"../../../../api/sessions#lux.extensions.sessions.backend.SessionMixin.success\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">success</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">):</span>\n        <span class=\"sd\">&#39;&#39;&#39;Store a ``success`` message to show to the web user</span>\n<span class=\"sd\">        &#39;&#39;&#39;</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"p\">(</span><span class=\"s\">&#39;success&#39;</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">)</span>\n</div>\n<div class=\"viewcode-block\" id=\"SessionMixin.info\"><a class=\"viewcode-back\" href=\"../../../../api/sessions#lux.extensions.sessions.backend.SessionMixin.info\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">info</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">):</span>\n        <span class=\"sd\">&#39;&#39;&#39;Store an ``info`` message to show to the web user</span>\n<span class=\"sd\">        &#39;&#39;&#39;</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"p\">(</span><span class=\"s\">&#39;info&#39;</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">)</span>\n</div>\n<div class=\"viewcode-block\" id=\"SessionMixin.warning\"><a class=\"viewcode-back\" href=\"../../../../api/sessions#lux.extensions.sessions.backend.SessionMixin.warning\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">warning</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">):</span>\n        <span class=\"sd\">&#39;&#39;&#39;Store a ``warning`` message to show to the web user</span>\n<span class=\"sd\">        &#39;&#39;&#39;</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"p\">(</span><span class=\"s\">&#39;warning&#39;</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">)</span>\n</div>\n<div class=\"viewcode-block\" id=\"SessionMixin.error\"><a class=\"viewcode-back\" href=\"../../../../api/sessions#lux.extensions.sessions.backend.SessionMixin.error\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">error</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">):</span>\n        <span class=\"sd\">&#39;&#39;&#39;Store an ``error`` message to show to the web user</span>\n<span class=\"sd\">        &#39;&#39;&#39;</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"p\">(</span><span class=\"s\">&#39;danger&#39;</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">)</span>\n</div>\n<div class=\"viewcode-block\" id=\"SessionMixin.message\"><a class=\"viewcode-back\" href=\"../../../../api/sessions#lux.extensions.sessions.backend.SessionMixin.message\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">message</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">level</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">):</span>\n        <span class=\"sd\">&#39;&#39;&#39;Store a ``message`` of ``level`` to show to the web user.</span>\n\n<span class=\"sd\">        Must be implemented by session classes.</span>\n<span class=\"sd\">        &#39;&#39;&#39;</span>\n        <span class=\"k\">raise</span> <span class=\"ne\">NotImplementedError</span>\n</div>\n<div class=\"viewcode-block\" id=\"SessionMixin.remove_message\"><a class=\"viewcode-back\" href=\"../../../../api/sessions#lux.extensions.sessions.backend.SessionMixin.remove_message\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">remove_message</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"p\">):</span>\n        <span class=\"sd\">&#39;&#39;&#39;Remove a message from the list of messages&#39;&#39;&#39;</span>\n        <span class=\"k\">raise</span> <span class=\"ne\">NotImplementedError</span>\n\n</div></div>\n<div class=\"viewcode-block\" id=\"UserMixin\"><a class=\"viewcode-back\" href=\"../../../../api/sessions#lux.extensions.sessions.backend.UserMixin\">[docs]</a><span class=\"k\">class</span> <span class=\"nc\">UserMixin</span><span class=\"p\">(</span><span class=\"nb\">object</span><span class=\"p\">):</span>\n    <span class=\"sd\">&#39;&#39;&#39;Mixin for a User model</span>\n<span class=\"sd\">    &#39;&#39;&#39;</span>\n    <span class=\"n\">email</span> <span class=\"o\">=</span> <span class=\"bp\">None</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">is_superuser</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"bp\">False</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">is_authenticated</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"bp\">True</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">is_active</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"bp\">False</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">is_anonymous</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"bp\">False</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_id</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">raise</span> <span class=\"ne\">NotImplementedError</span>\n\n<div class=\"viewcode-block\" id=\"UserMixin.get_oauths\"><a class=\"viewcode-back\" href=\"../../../../api/sessions#lux.extensions.sessions.backend.UserMixin.get_oauths\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">get_oauths</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"sd\">&#39;&#39;&#39;Return a dictionary of oauths account&#39;&#39;&#39;</span>\n        <span class=\"k\">return</span> <span class=\"p\">{}</span>\n</div>\n    <span class=\"k\">def</span> <span class=\"nf\">set_oauth</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"p\">):</span>\n        <span class=\"k\">raise</span> <span class=\"ne\">NotImplementedError</span>\n\n<div class=\"viewcode-block\" id=\"UserMixin.remove_oauth\"><a class=\"viewcode-back\" href=\"../../../../api/sessions#lux.extensions.sessions.backend.UserMixin.remove_oauth\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">remove_oauth</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">):</span>\n        <span class=\"sd\">&#39;&#39;&#39;Remove a connected oauth account.</span>\n<span class=\"sd\">        Return ``True`` if successfully removed</span>\n<span class=\"sd\">        &#39;&#39;&#39;</span>\n        <span class=\"k\">raise</span> <span class=\"ne\">NotImplementedError</span>\n</div>\n<div class=\"viewcode-block\" id=\"UserMixin.email_user\"><a class=\"viewcode-back\" href=\"../../../../api/sessions#lux.extensions.sessions.backend.UserMixin.email_user\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">email_user</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">subject</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">,</span> <span class=\"n\">from_email</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n        <span class=\"sd\">&#39;&#39;&#39;Sends an email to this User&#39;&#39;&#39;</span>\n        <span class=\"n\">send_mail</span><span class=\"p\">(</span><span class=\"n\">subject</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">,</span> <span class=\"n\">from_email</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">email</span><span class=\"p\">],</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)</span>\n</div>\n    <span class=\"nd\">@classmethod</span>\n<div class=\"viewcode-block\" id=\"UserMixin.get_by_username\"><a class=\"viewcode-back\" href=\"../../../../api/sessions#lux.extensions.sessions.backend.UserMixin.get_by_username\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">get_by_username</span><span class=\"p\">(</span><span class=\"n\">cls</span><span class=\"p\">,</span> <span class=\"n\">username</span><span class=\"p\">):</span>\n        <span class=\"sd\">&#39;&#39;&#39;Retrieve a user from username</span>\n<span class=\"sd\">        &#39;&#39;&#39;</span>\n        <span class=\"k\">raise</span> <span class=\"ne\">NotImplementedError</span>\n</div>\n    <span class=\"nd\">@classmethod</span>\n    <span class=\"k\">def</span> <span class=\"nf\">get_by_email</span><span class=\"p\">(</span><span class=\"n\">cls</span><span class=\"p\">,</span> <span class=\"n\">email</span><span class=\"p\">):</span>\n        <span class=\"k\">raise</span> <span class=\"ne\">NotImplementedError</span>\n\n    <span class=\"nd\">@classmethod</span>\n<div class=\"viewcode-block\" id=\"UserMixin.get_by_oauth\"><a class=\"viewcode-back\" href=\"../../../../api/sessions#lux.extensions.sessions.backend.UserMixin.get_by_oauth\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">get_by_oauth</span><span class=\"p\">(</span><span class=\"n\">cls</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">identifier</span><span class=\"p\">):</span>\n        <span class=\"sd\">&#39;&#39;&#39;Retrieve a user from OAuth ``name`` with ``identifier``</span>\n<span class=\"sd\">        &#39;&#39;&#39;</span>\n        <span class=\"k\">raise</span> <span class=\"ne\">NotImplementedError</span>\n\n</div></div>\n<span class=\"k\">class</span> <span class=\"nc\">Anonymous</span><span class=\"p\">(</span><span class=\"n\">UserMixin</span><span class=\"p\">):</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">is_authenticated</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"bp\">False</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">is_anonymous</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"bp\">True</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_id</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"mi\">0</span>\n\n\n<div class=\"viewcode-block\" id=\"AuthBackend\"><a class=\"viewcode-back\" href=\"../../../../api/sessions#lux.extensions.sessions.backend.AuthBackend\">[docs]</a><span class=\"k\">class</span> <span class=\"nc\">AuthBackend</span><span class=\"p\">(</span><span class=\"nb\">object</span><span class=\"p\">):</span>\n    <span class=\"sd\">&#39;&#39;&#39;Interface for authentication backends.</span>\n\n<span class=\"sd\">    An Authentication backend manage authentication, login, logout and</span>\n<span class=\"sd\">    several other activities which are required for managing users of</span>\n<span class=\"sd\">    a web site.</span>\n<span class=\"sd\">    &#39;&#39;&#39;</span>\n    <span class=\"n\">model</span> <span class=\"o\">=</span> <span class=\"bp\">None</span>\n    <span class=\"n\">ForgotPasswordRouter</span> <span class=\"o\">=</span> <span class=\"bp\">None</span>\n    <span class=\"n\">READ</span> <span class=\"o\">=</span> <span class=\"mi\">10</span>\n    <span class=\"n\">UPDATE</span> <span class=\"o\">=</span> <span class=\"mi\">20</span>\n    <span class=\"n\">CREATE</span> <span class=\"o\">=</span> <span class=\"mi\">30</span>\n    <span class=\"n\">REMOVE</span> <span class=\"o\">=</span> <span class=\"mi\">40</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">app</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">encoding</span> <span class=\"o\">=</span> <span class=\"n\">app</span><span class=\"o\">.</span><span class=\"n\">config</span><span class=\"p\">[</span><span class=\"s\">&#39;ENCODING&#39;</span><span class=\"p\">]</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">secret_key</span> <span class=\"o\">=</span> <span class=\"n\">app</span><span class=\"o\">.</span><span class=\"n\">config</span><span class=\"p\">[</span><span class=\"s\">&#39;SECRET_KEY&#39;</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">encode</span><span class=\"p\">()</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">session_cookie_name</span> <span class=\"o\">=</span> <span class=\"n\">app</span><span class=\"o\">.</span><span class=\"n\">config</span><span class=\"p\">[</span><span class=\"s\">&#39;SESSION_COOKIE_NAME&#39;</span><span class=\"p\">]</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">session_expiry</span> <span class=\"o\">=</span> <span class=\"n\">app</span><span class=\"o\">.</span><span class=\"n\">config</span><span class=\"p\">[</span><span class=\"s\">&#39;SESSION_EXPIRY&#39;</span><span class=\"p\">]</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">salt_size</span> <span class=\"o\">=</span> <span class=\"n\">app</span><span class=\"o\">.</span><span class=\"n\">config</span><span class=\"p\">[</span><span class=\"s\">&#39;AUTH_SALT_SIZE&#39;</span><span class=\"p\">]</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">check_username</span> <span class=\"o\">=</span> <span class=\"n\">app</span><span class=\"o\">.</span><span class=\"n\">config</span><span class=\"p\">[</span><span class=\"s\">&#39;CHECK_USERNAME&#39;</span><span class=\"p\">]</span>\n        <span class=\"n\">algorithm</span> <span class=\"o\">=</span> <span class=\"n\">app</span><span class=\"o\">.</span><span class=\"n\">config</span><span class=\"p\">[</span><span class=\"s\">&#39;CRYPT_ALGORITHM&#39;</span><span class=\"p\">]</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">crypt_module</span> <span class=\"o\">=</span> <span class=\"n\">import_module</span><span class=\"p\">(</span><span class=\"n\">algorithm</span><span class=\"p\">)</span>\n\n<div class=\"viewcode-block\" id=\"AuthBackend.create_registration\"><a class=\"viewcode-back\" href=\"../../../../api/sessions#lux.extensions.sessions.backend.AuthBackend.create_registration\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">create_registration</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">user</span><span class=\"p\">,</span> <span class=\"n\">expiry</span><span class=\"p\">):</span>\n        <span class=\"sd\">&#39;&#39;&#39;Create a registration entry for a user.</span>\n<span class=\"sd\">        This method should return the registration/activation key.&#39;&#39;&#39;</span>\n        <span class=\"k\">raise</span> <span class=\"ne\">NotImplementedError</span>\n</div>\n<div class=\"viewcode-block\" id=\"AuthBackend.authenticate\"><a class=\"viewcode-back\" href=\"../../../../api/sessions#lux.extensions.sessions.backend.AuthBackend.authenticate\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">authenticate</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">params</span><span class=\"p\">):</span>\n        <span class=\"sd\">&#39;&#39;&#39;Authenticate user&#39;&#39;&#39;</span>\n        <span class=\"k\">raise</span> <span class=\"ne\">NotImplementedError</span>\n</div>\n<div class=\"viewcode-block\" id=\"AuthBackend.confirm_registration\"><a class=\"viewcode-back\" href=\"../../../../api/sessions#lux.extensions.sessions.backend.AuthBackend.confirm_registration\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">confirm_registration</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">params</span><span class=\"p\">):</span>\n        <span class=\"sd\">&#39;&#39;&#39;Confirm registration&#39;&#39;&#39;</span>\n        <span class=\"k\">raise</span> <span class=\"ne\">NotImplementedError</span>\n</div>\n<div class=\"viewcode-block\" id=\"AuthBackend.create_session\"><a class=\"viewcode-back\" href=\"../../../../api/sessions#lux.extensions.sessions.backend.AuthBackend.create_session\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">create_session</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">user</span><span class=\"o\">=</span><span class=\"bp\">None</span><span class=\"p\">,</span> <span class=\"n\">expiry</span><span class=\"o\">=</span><span class=\"bp\">None</span><span class=\"p\">):</span>\n        <span class=\"sd\">&#39;&#39;&#39;Create a new session</span>\n<span class=\"sd\">        &#39;&#39;&#39;</span>\n        <span class=\"k\">raise</span> <span class=\"ne\">NotImplementedError</span>\n</div>\n<div class=\"viewcode-block\" id=\"AuthBackend.csrf_token\"><a class=\"viewcode-back\" href=\"../../../../api/sessions#lux.extensions.sessions.backend.AuthBackend.csrf_token\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">csrf_token</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">session</span><span class=\"p\">):</span>\n        <span class=\"sd\">&#39;&#39;&#39;Create a token for CSRF</span>\n<span class=\"sd\">        &#39;&#39;&#39;</span>\n        <span class=\"k\">pass</span>\n</div>\n<div class=\"viewcode-block\" id=\"AuthBackend.validate_csrf_token\"><a class=\"viewcode-back\" href=\"../../../../api/sessions#lux.extensions.sessions.backend.AuthBackend.validate_csrf_token\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">validate_csrf_token</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">token</span><span class=\"p\">):</span>\n        <span class=\"sd\">&#39;&#39;&#39;Validate CSRF</span>\n<span class=\"sd\">        &#39;&#39;&#39;</span>\n        <span class=\"k\">pass</span>\n</div>\n<div class=\"viewcode-block\" id=\"AuthBackend.get_user\"><a class=\"viewcode-back\" href=\"../../../../api/sessions#lux.extensions.sessions.backend.AuthBackend.get_user\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">get_user</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n        <span class=\"sd\">&#39;&#39;&#39;Retrieve a user.</span>\n<span class=\"sd\">        Return ``None`` if the user could not be found&#39;&#39;&#39;</span>\n        <span class=\"k\">pass</span>\n</div>\n<div class=\"viewcode-block\" id=\"AuthBackend.set_password\"><a class=\"viewcode-back\" href=\"../../../../api/sessions#lux.extensions.sessions.backend.AuthBackend.set_password\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">set_password</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">user</span><span class=\"p\">,</span> <span class=\"n\">password</span><span class=\"p\">):</span>\n        <span class=\"sd\">&#39;&#39;&#39;Set the password for ``user``.</span>\n<span class=\"sd\">        This method should commit changes.&#39;&#39;&#39;</span>\n        <span class=\"k\">raise</span> <span class=\"ne\">NotImplementedError</span>\n</div>\n<div class=\"viewcode-block\" id=\"AuthBackend.auth_key_used\"><a class=\"viewcode-back\" href=\"../../../../api/sessions#lux.extensions.sessions.backend.AuthBackend.auth_key_used\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">auth_key_used</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">key</span><span class=\"p\">):</span>\n        <span class=\"sd\">&#39;&#39;&#39;The authentication ``key`` has been used and this method is</span>\n<span class=\"sd\">        for setting/updating the backend model accordingly.</span>\n<span class=\"sd\">        Used during password retrieval and user registration</span>\n<span class=\"sd\">        &#39;&#39;&#39;</span>\n        <span class=\"k\">raise</span> <span class=\"ne\">NotImplementedError</span>\n</div>\n<div class=\"viewcode-block\" id=\"AuthBackend.login\"><a class=\"viewcode-back\" href=\"../../../../api/sessions#lux.extensions.sessions.backend.AuthBackend.login\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">login</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">user</span><span class=\"o\">=</span><span class=\"bp\">None</span><span class=\"p\">):</span>\n        <span class=\"sd\">&#39;&#39;&#39;Login a user from a model or from post data</span>\n<span class=\"sd\">        &#39;&#39;&#39;</span>\n        <span class=\"k\">if</span> <span class=\"n\">user</span> <span class=\"ow\">is</span> <span class=\"bp\">None</span><span class=\"p\">:</span>\n            <span class=\"n\">data</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">body_data</span><span class=\"p\">()</span>\n            <span class=\"n\">user</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">authenticate</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">data</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"n\">user</span> <span class=\"ow\">is</span> <span class=\"bp\">None</span><span class=\"p\">:</span>\n                <span class=\"k\">raise</span> <span class=\"n\">AuthenticationError</span><span class=\"p\">(</span><span class=\"s\">&#39;Invalid username or password&#39;</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">user</span><span class=\"o\">.</span><span class=\"n\">is_active</span><span class=\"p\">():</span>\n            <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">inactive_user_login</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">user</span><span class=\"p\">)</span>\n        <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">cache</span><span class=\"o\">.</span><span class=\"n\">session</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">create_session</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">user</span><span class=\"p\">)</span>\n        <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">cache</span><span class=\"o\">.</span><span class=\"n\">user</span> <span class=\"o\">=</span> <span class=\"n\">user</span>\n        <span class=\"k\">return</span> <span class=\"n\">user</span>\n</div>\n<div class=\"viewcode-block\" id=\"AuthBackend.inactive_user_login\"><a class=\"viewcode-back\" href=\"../../../../api/sessions#lux.extensions.sessions.backend.AuthBackend.inactive_user_login\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">inactive_user_login</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">user</span><span class=\"p\">):</span>\n        <span class=\"sd\">&#39;&#39;&#39;Handle a user not yet active&#39;&#39;&#39;</span>\n        <span class=\"n\">cfg</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">config</span>\n        <span class=\"n\">url</span> <span class=\"o\">=</span> <span class=\"s\">&#39;/signup/confirmation/</span><span class=\"si\">%s</span><span class=\"s\">&#39;</span> <span class=\"o\">%</span> <span class=\"n\">user</span><span class=\"o\">.</span><span class=\"n\">username</span>\n        <span class=\"n\">session</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">cache</span><span class=\"o\">.</span><span class=\"n\">session</span>\n        <span class=\"n\">context</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"s\">&#39;email&#39;</span><span class=\"p\">:</span> <span class=\"n\">user</span><span class=\"o\">.</span><span class=\"n\">email</span><span class=\"p\">,</span>\n                   <span class=\"s\">&#39;email_from&#39;</span><span class=\"p\">:</span> <span class=\"n\">cfg</span><span class=\"p\">[</span><span class=\"s\">&#39;DEFAULT_FROM_EMAIL&#39;</span><span class=\"p\">],</span>\n                   <span class=\"s\">&#39;confirmation_url&#39;</span><span class=\"p\">:</span> <span class=\"n\">url</span><span class=\"p\">}</span>\n        <span class=\"n\">message</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">app</span><span class=\"o\">.</span><span class=\"n\">render_template</span><span class=\"p\">(</span><span class=\"s\">&#39;inactive.txt&#39;</span><span class=\"p\">,</span> <span class=\"n\">context</span><span class=\"p\">)</span>\n        <span class=\"n\">session</span><span class=\"o\">.</span><span class=\"n\">warning</span><span class=\"p\">(</span><span class=\"n\">message</span><span class=\"p\">)</span>\n</div>\n<div class=\"viewcode-block\" id=\"AuthBackend.logout\"><a class=\"viewcode-back\" href=\"../../../../api/sessions#lux.extensions.sessions.backend.AuthBackend.logout\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">logout</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">user</span><span class=\"o\">=</span><span class=\"bp\">None</span><span class=\"p\">):</span>\n        <span class=\"sd\">&#39;&#39;&#39;Logout a ``user``</span>\n<span class=\"sd\">        &#39;&#39;&#39;</span>\n        <span class=\"n\">session</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">cache</span><span class=\"o\">.</span><span class=\"n\">session</span>\n        <span class=\"n\">user</span> <span class=\"o\">=</span> <span class=\"n\">user</span> <span class=\"ow\">or</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">cache</span><span class=\"o\">.</span><span class=\"n\">user</span>\n        <span class=\"k\">if</span> <span class=\"n\">user</span> <span class=\"ow\">and</span> <span class=\"n\">user</span><span class=\"o\">.</span><span class=\"n\">is_authenticated</span><span class=\"p\">():</span>\n            <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">cache</span><span class=\"o\">.</span><span class=\"n\">session</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">create_session</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n            <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">cache</span><span class=\"o\">.</span><span class=\"n\">user</span> <span class=\"o\">=</span> <span class=\"n\">Anonymous</span><span class=\"p\">()</span>\n</div>\n<div class=\"viewcode-block\" id=\"AuthBackend.get_or_create_registration\"><a class=\"viewcode-back\" href=\"../../../../api/sessions#lux.extensions.sessions.backend.AuthBackend.get_or_create_registration\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">get_or_create_registration</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">user</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kw</span><span class=\"p\">):</span>\n        <span class=\"sd\">&#39;&#39;&#39;Create a registration profile for ``user``.</span>\n\n<span class=\"sd\">        This method send an email to the user so that the email</span>\n<span class=\"sd\">        is verified once the user follows the link in the email.</span>\n\n<span class=\"sd\">        Usually called after user registration.</span>\n<span class=\"sd\">        &#39;&#39;&#39;</span>\n        <span class=\"k\">if</span> <span class=\"n\">user</span> <span class=\"ow\">and</span> <span class=\"n\">user</span><span class=\"o\">.</span><span class=\"n\">email</span><span class=\"p\">:</span>\n            <span class=\"n\">days</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">config</span><span class=\"p\">[</span><span class=\"s\">&#39;ACCOUNT_ACTIVATION_DAYS&#39;</span><span class=\"p\">]</span>\n            <span class=\"n\">expiry</span> <span class=\"o\">=</span> <span class=\"n\">datetime</span><span class=\"o\">.</span><span class=\"n\">now</span><span class=\"p\">()</span> <span class=\"o\">+</span> <span class=\"n\">timedelta</span><span class=\"p\">(</span><span class=\"n\">days</span><span class=\"o\">=</span><span class=\"n\">days</span><span class=\"p\">)</span>\n            <span class=\"n\">auth_key</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">create_registration</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">user</span><span class=\"p\">,</span> <span class=\"n\">expiry</span><span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">send_email_confirmation</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">user</span><span class=\"p\">,</span> <span class=\"n\">auth_key</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kw</span><span class=\"p\">)</span>\n            <span class=\"k\">return</span> <span class=\"n\">auth_key</span>\n</div>\n    <span class=\"k\">def</span> <span class=\"nf\">password_recovery</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">email</span><span class=\"p\">):</span>\n        <span class=\"n\">user</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">get_by_email</span><span class=\"p\">(</span><span class=\"n\">email</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_or_create_registration</span><span class=\"p\">(</span>\n                <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">user</span><span class=\"p\">,</span> <span class=\"n\">email_subject</span><span class=\"o\">=</span><span class=\"s\">&#39;password_email_subject.txt&#39;</span><span class=\"p\">,</span>\n                <span class=\"n\">email_message</span><span class=\"o\">=</span><span class=\"s\">&#39;password_email.txt&#39;</span><span class=\"p\">,</span>\n                <span class=\"n\">message</span><span class=\"o\">=</span><span class=\"s\">&#39;password_message.txt&#39;</span><span class=\"p\">):</span>\n            <span class=\"k\">raise</span> <span class=\"n\">AuthenticationError</span><span class=\"p\">(</span><span class=\"s\">&quot;Can&#39;t find that email, sorry&quot;</span><span class=\"p\">)</span>\n\n<div class=\"viewcode-block\" id=\"AuthBackend.create_user\"><a class=\"viewcode-back\" href=\"../../../../api/sessions#lux.extensions.sessions.backend.AuthBackend.create_user\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">create_user</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n        <span class=\"sd\">&#39;&#39;&#39;Create a standard user.&#39;&#39;&#39;</span>\n        <span class=\"k\">pass</span>\n</div>\n<div class=\"viewcode-block\" id=\"AuthBackend.create_superuser\"><a class=\"viewcode-back\" href=\"../../../../api/sessions#lux.extensions.sessions.backend.AuthBackend.create_superuser\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">create_superuser</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n        <span class=\"sd\">&#39;&#39;&#39;Create a user with *superuser* permissions.&#39;&#39;&#39;</span>\n        <span class=\"k\">pass</span>\n</div>\n    <span class=\"k\">def</span> <span class=\"nf\">middleware</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">app</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"p\">()</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">response_middleware</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">app</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"p\">()</span>\n\n<div class=\"viewcode-block\" id=\"AuthBackend.has_permission\"><a class=\"viewcode-back\" href=\"../../../../api/sessions#lux.extensions.sessions.backend.AuthBackend.has_permission\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">has_permission</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">level</span><span class=\"p\">,</span> <span class=\"n\">model</span><span class=\"p\">):</span>\n        <span class=\"sd\">&#39;&#39;&#39;Check for permission on a model.&#39;&#39;&#39;</span>\n        <span class=\"k\">return</span> <span class=\"bp\">False</span>\n</div>\n    <span class=\"k\">def</span> <span class=\"nf\">password</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">raw_password</span><span class=\"o\">=</span><span class=\"bp\">None</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"n\">raw_password</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_encript</span><span class=\"p\">(</span><span class=\"n\">raw_password</span><span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"n\">UNUSABLE_PASSWORD</span>\n\n<div class=\"viewcode-block\" id=\"AuthBackend.normalise_email\"><a class=\"viewcode-back\" href=\"../../../../api/sessions#lux.extensions.sessions.backend.AuthBackend.normalise_email\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">normalise_email</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">email</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Normalise the address by lowercasing the domain part of the email</span>\n<span class=\"sd\">        address.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"n\">email</span> <span class=\"o\">=</span> <span class=\"n\">email</span> <span class=\"ow\">or</span> <span class=\"s\">&#39;&#39;</span>\n        <span class=\"k\">try</span><span class=\"p\">:</span>\n            <span class=\"n\">email_name</span><span class=\"p\">,</span> <span class=\"n\">domain_part</span> <span class=\"o\">=</span> <span class=\"n\">email</span><span class=\"o\">.</span><span class=\"n\">strip</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">rsplit</span><span class=\"p\">(</span><span class=\"s\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n        <span class=\"k\">except</span> <span class=\"ne\">ValueError</span><span class=\"p\">:</span>\n            <span class=\"k\">pass</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">email</span> <span class=\"o\">=</span> <span class=\"s\">&#39;@&#39;</span><span class=\"o\">.</span><span class=\"n\">join</span><span class=\"p\">([</span><span class=\"n\">email_name</span><span class=\"p\">,</span> <span class=\"n\">domain_part</span><span class=\"o\">.</span><span class=\"n\">lower</span><span class=\"p\">()])</span>\n        <span class=\"k\">return</span> <span class=\"n\">email</span>\n</div>\n<div class=\"viewcode-block\" id=\"AuthBackend.send_email_confirmation\"><a class=\"viewcode-back\" href=\"../../../../api/sessions#lux.extensions.sessions.backend.AuthBackend.send_email_confirmation\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">send_email_confirmation</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">user</span><span class=\"p\">,</span> <span class=\"n\">auth_key</span><span class=\"p\">,</span>\n                                <span class=\"n\">email_subject</span><span class=\"o\">=</span><span class=\"bp\">None</span><span class=\"p\">,</span> <span class=\"n\">email_message</span><span class=\"o\">=</span><span class=\"bp\">None</span><span class=\"p\">,</span>\n                                <span class=\"n\">message</span><span class=\"o\">=</span><span class=\"bp\">None</span><span class=\"p\">):</span>\n        <span class=\"sd\">&#39;&#39;&#39;Send an email to user to confirm his/her email address&#39;&#39;&#39;</span>\n        <span class=\"n\">app</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">app</span>\n        <span class=\"n\">cfg</span> <span class=\"o\">=</span> <span class=\"n\">app</span><span class=\"o\">.</span><span class=\"n\">config</span>\n        <span class=\"n\">ctx</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"s\">&#39;auth_key&#39;</span><span class=\"p\">:</span> <span class=\"n\">auth_key</span><span class=\"p\">,</span>\n               <span class=\"s\">&#39;expiration_days&#39;</span><span class=\"p\">:</span> <span class=\"n\">cfg</span><span class=\"p\">[</span><span class=\"s\">&#39;ACCOUNT_ACTIVATION_DAYS&#39;</span><span class=\"p\">],</span>\n               <span class=\"s\">&#39;email&#39;</span><span class=\"p\">:</span> <span class=\"n\">user</span><span class=\"o\">.</span><span class=\"n\">email</span><span class=\"p\">,</span>\n               <span class=\"s\">&#39;site_uri&#39;</span><span class=\"p\">:</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">absolute_uri</span><span class=\"p\">(</span><span class=\"s\">&#39;/&#39;</span><span class=\"p\">)[:</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">]}</span>\n\n        <span class=\"n\">subject</span> <span class=\"o\">=</span> <span class=\"n\">app</span><span class=\"o\">.</span><span class=\"n\">render_template</span><span class=\"p\">(</span>\n            <span class=\"n\">email_subject</span> <span class=\"ow\">or</span> <span class=\"s\">&#39;activation_email_subject.txt&#39;</span><span class=\"p\">,</span> <span class=\"n\">ctx</span><span class=\"p\">)</span>\n        <span class=\"c\"># Email subject *must not* contain newlines</span>\n        <span class=\"n\">subject</span> <span class=\"o\">=</span> <span class=\"s\">&#39;&#39;</span><span class=\"o\">.</span><span class=\"n\">join</span><span class=\"p\">(</span><span class=\"n\">subject</span><span class=\"o\">.</span><span class=\"n\">splitlines</span><span class=\"p\">())</span>\n        <span class=\"n\">body</span> <span class=\"o\">=</span> <span class=\"n\">app</span><span class=\"o\">.</span><span class=\"n\">render_template</span><span class=\"p\">(</span>\n            <span class=\"n\">email_message</span> <span class=\"ow\">or</span> <span class=\"s\">&#39;activation_email.txt&#39;</span><span class=\"p\">,</span> <span class=\"n\">ctx</span><span class=\"p\">)</span>\n        <span class=\"n\">user</span><span class=\"o\">.</span><span class=\"n\">email_user</span><span class=\"p\">(</span><span class=\"n\">subject</span><span class=\"p\">,</span> <span class=\"n\">body</span><span class=\"p\">,</span> <span class=\"n\">cfg</span><span class=\"p\">[</span><span class=\"s\">&#39;DEFAULT_FROM_EMAIL&#39;</span><span class=\"p\">])</span>\n        <span class=\"n\">message</span> <span class=\"o\">=</span> <span class=\"n\">app</span><span class=\"o\">.</span><span class=\"n\">render_template</span><span class=\"p\">(</span>\n            <span class=\"n\">message</span> <span class=\"ow\">or</span> <span class=\"s\">&#39;activation_message.txt&#39;</span><span class=\"p\">,</span> <span class=\"n\">ctx</span><span class=\"p\">)</span>\n        <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">cache</span><span class=\"o\">.</span><span class=\"n\">session</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"n\">message</span><span class=\"p\">)</span>\n</div>\n    <span class=\"k\">def</span> <span class=\"nf\">decript</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">password</span><span class=\"o\">=</span><span class=\"bp\">None</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"n\">password</span><span class=\"p\">:</span>\n            <span class=\"n\">p</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">crypt_module</span><span class=\"o\">.</span><span class=\"n\">decrypt</span><span class=\"p\">(</span><span class=\"n\">to_bytes</span><span class=\"p\">(</span><span class=\"n\">password</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">encoding</span><span class=\"p\">),</span>\n                                          <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">secret_key</span><span class=\"p\">)</span>\n            <span class=\"k\">return</span> <span class=\"n\">to_string</span><span class=\"p\">(</span><span class=\"n\">p</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">encoding</span><span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"n\">UNUSABLE_PASSWORD</span>\n\n    <span class=\"c\"># INTERNALS</span>\n    <span class=\"k\">def</span> <span class=\"nf\">_encript</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">password</span><span class=\"p\">):</span>\n        <span class=\"n\">p</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">crypt_module</span><span class=\"o\">.</span><span class=\"n\">encrypt</span><span class=\"p\">(</span><span class=\"n\">to_bytes</span><span class=\"p\">(</span><span class=\"n\">password</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">encoding</span><span class=\"p\">),</span>\n                                      <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">secret_key</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">salt_size</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">to_string</span><span class=\"p\">(</span><span class=\"n\">p</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">encoding</span><span class=\"p\">)</span></div>\n</pre></div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n<div class='small hidden-print text-muted' id='page-footer'>\n    <div class='container'>\n        <div class='row'>\n            <div class='block col-sm-5'>\n                <div class='hidden-xs'>\n                    <ul class=\"fa-ul text-left\">\n    <li><i class=\"fa-li fa fa-copyright\"></i>2014 <a href=\"http://quantmind.com\">Quantmind</a></li>\n    <li>Site build with Lux on python 3.4.1</li>\n    <li>Docs build with <a href=\"http://sphinx-doc.org/\" target=\"_blank\">Sphinx</a></li>\n    <li><a href=\"http://quantmind.github.io/lux/docs/changelog\">Changelog</a></li>\n    <li><a href=\"http://quantmind.github.io/lux/docs/api/\">API</a></li>\n    <li><a href=\"http://quantmind.github.io/lux/docs/EXTENSIONS/\">Extensions</a></li>\n    <li><a href=\"http://quantmind.github.io/lux/images\">Images</a></li>\n</ul>\n                </div>\n                <div class='text-center visible-xs'>\n                    <ul class=\"fa-ul text-left\">\n    <li><i class=\"fa-li fa fa-copyright\"></i>2014 <a href=\"http://quantmind.com\">Quantmind</a></li>\n    <li>Site build with Lux on python 3.4.1</li>\n    <li>Docs build with <a href=\"http://sphinx-doc.org/\" target=\"_blank\">Sphinx</a></li>\n    <li><a href=\"http://quantmind.github.io/lux/docs/changelog\">Changelog</a></li>\n    <li><a href=\"http://quantmind.github.io/lux/docs/api/\">API</a></li>\n    <li><a href=\"http://quantmind.github.io/lux/docs/EXTENSIONS/\">Extensions</a></li>\n    <li><a href=\"http://quantmind.github.io/lux/images\">Images</a></li>\n</ul>\n                </div>\n            </div>\n            <div class='block col-sm-2 text-center'>\n                <div class='hidden-xs'>\n                    <p><a href='#top' title=\"Lux\" class=\"hover-opacity\">\n    <img height=50 title='Lux' src='http://quantmind.github.io/lux/media/luxsite/lux.png' alt='Lux'>\n</a></p>\n                </div>\n                <div class='visible-xs'>\n                    <p><a href='https://twitter.com/quantmind' title='Follow quantmind on twitter'>\n<i class='fa fa-twitter fa-2x'></i></a>\n<a href='https://plus.google.com/+QuantmindPlus' title='Follow quantmind on google+'>\n<i class='fa fa-google-plus-square fa-2x'></i></a>\n<a href='https://www.facebook.com/quantmind' title='Follow quantmind on facebook'>\n<i class='fa fa-facebook-square fa-2x'></i></a>\n<a href='https://github.com/quantmind/lux' title='Lux on github'>\n<i class='fa fa-github fa-2x'></i></a></p>\n                </div>\n            </div>\n            <div class='block col-sm-5'>\n                <div class='text-right hidden-xs'>\n                    <p><a href='https://twitter.com/quantmind' title='Follow quantmind on twitter'>\n<i class='fa fa-twitter fa-2x'></i></a>\n<a href='https://plus.google.com/+QuantmindPlus' title='Follow quantmind on google+'>\n<i class='fa fa-google-plus-square fa-2x'></i></a>\n<a href='https://www.facebook.com/quantmind' title='Follow quantmind on facebook'>\n<i class='fa fa-facebook-square fa-2x'></i></a>\n<a href='https://github.com/quantmind/lux' title='Lux on github'>\n<i class='fa fa-github fa-2x'></i></a></p>\n                </div>\n                <div class='text-center visible-xs'>\n                    <p><a href='#top' title=\"Lux\" class=\"hover-opacity\">\n    <img height=50 title='Lux' src='http://quantmind.github.io/lux/media/luxsite/lux.png' alt='Lux'>\n</a></p>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>"}, "html_url": "http://quantmind.github.io/lux/docs/modules/lux/extensions/sessions/backend", "slug": "modules/lux/extensions/sessions/backend", "site": {"url": "http://quantmind.github.io/lux", "template": "doc.html", "date": "2014-10-14T09-01-57", "python_version": "3.4.1", "name": "Lux", "template_engine": null, "media": "/media", "lux_version": "0.1.0-alpha.1", "year": 2014}, "modified": "2014-10-14T09:02:02", "content_type": "text/html", "head": {}, "api_url": "http://quantmind.github.io/lux/jsonapi/docs/modules/lux/extensions/sessions/backend"}