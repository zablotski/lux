<!DOCTYPE html>

<html>
<head>
  <title> LUX CMS</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="cms.html">
                cms.js
              </a>
            
              
              <a class="source" href="datagrid.html">
                datagrid.js
              </a>
            
              
              <a class="source" href="lorem.html">
                lorem.js
              </a>
            
              
              <a class="source" href="lux-web.html">
                lux-web.js
              </a>
            
              
              <a class="source" href="lux.html">
                lux.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1 id="-lux-cms"> LUX CMS</h1>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p> Fornt-end implementation of lux content management system
 extension. It provides an easy and elegant way to add content to
 pages. It includes:</p>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <ul>
<li><a href="#inline-editing">Inline editing</a> of <a href="#content-view">content views</a></li>
<li>drag &amp; drop for content blocks within a page</li>
<li>Extendibility using javascript alone</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p> The layout starts with a Page which contains a given set of <code>Grid</code>
 components, each managed by a <a href="#gridview">GridView</a>.</p>
<p> Each <code>Grid</code> contains one or more <code>Row</code> components which can be added
 interactively. A row has several templates with a predefined set of
 <code>Columns</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>define([<span class="hljs-string">'lux'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(lux)</span> {</span>
<span class="hljs-pi">    "use strict"</span>;

    <span class="hljs-keyword">var</span>
    logger = lux.getLogger(<span class="hljs-string">'cms'</span>),</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>    cms = lux.cms = {
        name: <span class="hljs-string">'page'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        _content_types: {},</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        _wrapper_types: {},</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>retrieve a content type by name</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        content_type: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(name)</span> {</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._content_types[name];
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>retrieve a wrapper type by name</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        wrapper_type: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(name)</span> {</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._wrapper_types[name];
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Return an array of Content types sorted by name</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        content_types: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._sorted(<span class="hljs-keyword">this</span>._content_types);
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Return an array of Wrapper types sorted by name</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        wrapper_types: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._sorted(<span class="hljs-keyword">this</span>._wrapper_types);
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Create a new Content model and add it to the available content
types.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        create_content_type: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(name, attrs, BaseContent)</span> {</span>
            <span class="hljs-keyword">var</span> meta = attrs.meta;
            <span class="hljs-keyword">if</span> (!BaseContent) {
                BaseContent = Content;
            }
            attrs.meta = attrs.meta || {};
            attrs.meta.name = name.toLowerCase();
            <span class="hljs-keyword">var</span> ct = BaseContent.extend(attrs);
            <span class="hljs-keyword">this</span>._content_types[ct._meta.name] = ct;
            <span class="hljs-keyword">return</span> ct;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Create a new Html Wrapper model and add it to the available wrappers
types.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        create_wrapper: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(name, attrs, BaseWrapper)</span> {</span>
            <span class="hljs-keyword">if</span> (!BaseWrapper) {
                BaseWrapper = Wrapper;
            }
            <span class="hljs-keyword">if</span> (!attrs.title) {
                attrs.title = name;
            }
            attrs.name = name.toLowerCase();
            <span class="hljs-keyword">var</span> NewWrapper = BaseWrapper.extend(attrs),
                wrapper = <span class="hljs-keyword">new</span> NewWrapper();
            <span class="hljs-keyword">this</span>._wrapper_types[wrapper.name] = wrapper;
            <span class="hljs-keyword">return</span> wrapper;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        set_transport: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(backend)</span> {</span>
            <span class="hljs-keyword">this</span>._backend = backend;
            _(<span class="hljs-keyword">this</span>._content_types).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(ct)</span> {</span>
                ct._meta.set_transport(backend);
            });
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Internal method used by <code>content_tyeps</code> and <code>wrapper_types</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        _sorted: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(iterable)</span> {</span>
            <span class="hljs-keyword">var</span> sortable = [];
            _(iterable).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(ct)</span> {</span>
                <span class="hljs-keyword">if</span> (ct._meta) {
                    ct = ct._meta;
                }
                sortable.push({value: ct.name, text: ct.title});
            });
            sortable.sort(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(a, b)</span> {</span>
                <span class="hljs-keyword">return</span> a.text &gt; b.text ? <span class="hljs-number">1</span> : -<span class="hljs-number">1</span>;
            });
            <span class="hljs-keyword">return</span> sortable;
        }
    };


    <span class="hljs-keyword">var</span> ROW_TEMPLATES = <span class="hljs-keyword">new</span> lux.Ordered(),
        BLOCK_TEMPLATES = <span class="hljs-keyword">new</span> lux.Ordered(),
        content_type = <span class="hljs-string">'content_type'</span>,
        dbfields = <span class="hljs-string">'dbfields'</span>,
        skin_color_element = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(state)</span> {</span>
            <span class="hljs-keyword">if</span> (!state.id) <span class="hljs-keyword">return</span> state.text; <span class="hljs-comment">// optgroup</span>
            <span class="hljs-keyword">return</span> <span class="hljs-string">"&lt;div class='colored "</span> + state.id + <span class="hljs-string">"'&gt;"</span> + state.text + <span class="hljs-string">"&lt;/div&gt;"</span>;
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <h2 id="content-model">Content Model</h2>

            </div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Base class for contents.
A new content class is created via the higher level utility function
<code>cms.create_content_type</code>.
A content can be persistent (its data is stored in a database) or not.
A non-persistent content stores its data in the page layout,
while the persistent one has also its own database representation.
To mark a model persistent, add the <code>persistent: true</code> attribute to
the <code>meta</code> object in the class definition.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> Content = cms.Content = lux.Model.extend({
        show_title: <span class="hljs-literal">false</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        meta: {
            name: <span class="hljs-string">'content'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>            fields: [
                <span class="hljs-keyword">new</span> lux.ChoiceField(<span class="hljs-string">'content_type'</span>, {
                    required: <span class="hljs-literal">true</span>,
                    choices: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                        <span class="hljs-keyword">return</span> cms.content_types();
                    },
                    fieldset: content_type,
                    select2: {placeholder: <span class="hljs-string">'Choose a content'</span>}
                }),</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">new</span> lux.ChoiceField(<span class="hljs-string">'wrapper'</span>, {
                    choices: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                        <span class="hljs-keyword">return</span> cms.wrapper_types();
                    },
                    fieldset: content_type,
                    select2: {minimumResultsForSearch: -<span class="hljs-number">1</span>}
                }),</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">new</span> lux.ChoiceField(<span class="hljs-string">'skin'</span>, {
                    choices: lux.SKIN_NAMES,
                    fieldset: content_type,
                    select2: {
                        placeholder: <span class="hljs-string">'Choose a skin'</span>,
                        formatResult: skin_color_element,
                        formatSelection: skin_color_element,
                        minimumResultsForSearch: -<span class="hljs-number">1</span>,
                        escapeMarkup: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(m)</span> {</span> <span class="hljs-keyword">return</span> m; }
                    }
                }),</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">new</span> lux.Field(<span class="hljs-string">'id'</span>, {
                    type: <span class="hljs-string">'hidden'</span>,
                    fieldset: dbfields
                }),</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">new</span> lux.Field(<span class="hljs-string">'title'</span>, {
                    required: <span class="hljs-literal">true</span>,
                    fieldset: dbfields
                }),</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">new</span> lux.KeywordsField(<span class="hljs-string">'keywords'</span>, {
                    fieldset: dbfields,
                    select2: {
                        tags: [],
                        initSelection : <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(element, callback)</span> {</span>
                            <span class="hljs-keyword">var</span> data = [];
                            _(element.val().split(<span class="hljs-string">","</span>)).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(val)</span> {</span>
                                <span class="hljs-keyword">if</span> (val) data.push({id: val, text: val});
                            });
                            callback(data);
                        }
                    }
                })
            ]
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Override the <code>getForm</code> method</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        getForm: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(options)</span> {</span>
            options || (options = {});
            options.model = <span class="hljs-keyword">this</span>;
            <span class="hljs-keyword">var</span> form = <span class="hljs-keyword">new</span> lux.Form(options);
            form.addFields(_.filter(<span class="hljs-keyword">this</span>._meta.fields, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(field)</span> {</span>
                <span class="hljs-keyword">return</span> !field.fieldset;
            }));
            <span class="hljs-keyword">return</span> form;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Render this Content into a <code>container</code>. Must be implemented
by subclasses</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        render: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(container)</span> {</span>},</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        close: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.container) {
                <span class="hljs-keyword">this</span>.container.trigger(<span class="hljs-string">'close-plugin-edit'</span>);
                <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.container;
            }
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Sync only if the content is persistent in the backend,
otherwise no need to do anything</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        sync: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(store, options)</span> {</span>
            <span class="hljs-keyword">this</span>.set(content_type, <span class="hljs-keyword">this</span>._meta.name);
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._meta.persistent) {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._super(store, options);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">if</span> (options &amp;&amp; options.success) {
                    options.success.call(<span class="hljs-keyword">this</span>._meta, <span class="hljs-keyword">this</span>.fields());
                }
            }
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Serialize the content.</p>
<p>Used by the PositionView when sychronosing with backend</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        serialize: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._meta.persistent) {
                <span class="hljs-keyword">var</span> pk = <span class="hljs-keyword">this</span>.pk();
                <span class="hljs-keyword">if</span> (pk) {
                    <span class="hljs-keyword">return</span> pk;
                }
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">this</span>.set(content_type, <span class="hljs-keyword">this</span>._meta.name);
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.fields();
            }
        }
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <h2 id="wrapper-model">Wrapper Model</h2>

            </div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Base class for html wrappers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> Wrapper = cms.Wrapper = lux.Class.extend({
        render: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(view)</span> {</span>
            view.content.render(view.elem);
        }
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <h2 id="page-model">Page Model</h2>

            </div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>A container of <code>Content</code> models displaied on a grid.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> Page = lux.Model.extend({
        meta: cms,</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Got new content update</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        update_content: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
            <span class="hljs-keyword">var</span> id = o.id,
                data = o.data;
            <span class="hljs-keyword">if</span> (id &amp;&amp; data) {
                <span class="hljs-keyword">var</span> ContentType = <span class="hljs-keyword">this</span>.content_type(data.content_type);
                <span class="hljs-keyword">if</span> (ContentType) {
                    <span class="hljs-keyword">var</span> meta = ContentType.prototype._meta;
                    <span class="hljs-keyword">return</span> meta.update(id, data);
                }
            }
            logger.error(<span class="hljs-string">'Could not understand content'</span>);
        }
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <h2 id="inline-editing">Inline Editing</h2>

            </div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Inline editing is implemented with a pop up dialog
within a <a href="#content-view">content view</a> element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
    <span class="hljs-keyword">var</span> edit_content_dialog = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(options)</span> {</span>
        <span class="hljs-keyword">var</span> dialog = <span class="hljs-keyword">new</span> lux.Dialog(options.contentedit),
            page_limit = options.page_limit || <span class="hljs-number">10</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>The grid containing the form</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            grid = $(document.createElement(<span class="hljs-string">'div'</span>)).addClass(<span class="hljs-string">'columns'</span>),
            content_fields = $(document.createElement(<span class="hljs-string">'div'</span>)).addClass(
                <span class="hljs-string">'content-fields column pull-left span8'</span>),
            content_data = $(document.createElement(<span class="hljs-string">'div'</span>)).addClass(
                <span class="hljs-string">'content-data column'</span>).css(<span class="hljs-string">'padding-left'</span>, content_fields.width()+<span class="hljs-number">20</span>),</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>            fieldset_content = $(document.createElement(<span class="hljs-string">'fieldset'</span>)).addClass(
                content_type).appendTo(content_fields),
            fieldset_dbfields= $(document.createElement(<span class="hljs-string">'fieldset'</span>)).addClass(
                dbfields).appendTo(content_fields),
            fieldset_submit= $(document.createElement(<span class="hljs-string">'fieldset'</span>)).addClass(
                <span class="hljs-string">'submit'</span>).appendTo(content_fields),</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Build the form container</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            form = <span class="hljs-keyword">new</span> lux.Form(),</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Create the select element for HTML wrappers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            wrapper_select,
            content_select,
            content_id,</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>            block;</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        form.elem.append(content_fields).append(content_data).appendTo(grid);
        form.addFields(Content._meta.fields);
        form.addSubmit({
            text: <span class="hljs-string">'Done'</span>,
            fieldset: fieldset_submit
        });
        form.render();</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Detach data fields</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        fieldset_dbfields.detach();</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        dialog.body()
            .append(grid)
            .addClass(<span class="hljs-string">'edit-content'</span>)
            .bind(<span class="hljs-string">'close-plugin-edit'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                dialog.destroy();
            });</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Change skin event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        form.elem.find(<span class="hljs-string">'[name="skin"]'</span>).change(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            block.skin = <span class="hljs-keyword">this</span>.value;
        });</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        content_id = fieldset_dbfields.find(<span class="hljs-string">'[name="id"]'</span>);
        content_select = fieldset_content.find(<span class="hljs-string">'[name="content_type"]'</span>);
        wrapper_select = fieldset_content.find(<span class="hljs-string">'[name="wrapper"]'</span>).change(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            block.wrapper = <span class="hljs-keyword">this</span>.value;
        });</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>AJAX Content Loading is available when the <code>options</code> object
contain the <code>content_url</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (options.content_url) {
            fieldset_dbfields.find(<span class="hljs-string">'[name="title"]'</span>).Select({
                placeholder: <span class="hljs-string">'Search content'</span>,
                minimumInputLength: <span class="hljs-number">2</span>,
                id: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data)</span> {</span>
                    <span class="hljs-keyword">return</span> data.title;
                },
                initSelection: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(element, callback)</span> {</span>
                    <span class="hljs-keyword">var</span> value = element.val();
                    callback({<span class="hljs-string">'title'</span>: value});
                },
                formatResult: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data, c, query)</span> {</span>
                    <span class="hljs-keyword">if</span> (!data.title) {</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>This must be the first entry</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        data.title = query.term;
                    }
                    <span class="hljs-keyword">return</span> <span class="hljs-string">'&lt;p&gt;'</span> + data.title + <span class="hljs-string">'&lt;/p&gt;'</span>;
                },
                formatSelection: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(object, container)</span> {</span>
                    <span class="hljs-keyword">if</span> (object.id === -<span class="hljs-number">1</span>) {
                        content_id.val(<span class="hljs-string">''</span>);
                    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (object.id) {
                        $.ajax({
                            url: options.content_url + <span class="hljs-string">'/'</span> + object.id,
                            success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(model_data)</span> {</span>
                                <span class="hljs-keyword">var</span> data = model_data,
                                    Content = cms.content_type(data.content_type);
                                <span class="hljs-keyword">if</span> (model_data.data) {
                                    data = model_data.data;
                                    <span class="hljs-keyword">delete</span> model_data.data;
                                    _.extend(data, model_data);
                                }
                                block.content = <span class="hljs-keyword">new</span> Content(data);
                                block.content.updateForm(form.elem);
                            }
                        });
                    }
                    <span class="hljs-keyword">return</span> object.title;
                },
                ajax: {
                    url: options.content_url,
                    minimumInputLength: <span class="hljs-number">3</span>,
                    data: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(term, page)</span> {</span>
                        <span class="hljs-keyword">return</span> {
                            q: term, <span class="hljs-comment">// search term</span>
                            per_page: page_limit,
                            field: [<span class="hljs-string">'id'</span>, <span class="hljs-string">'title'</span>],
                            content_type: block.content._meta.name,
                            apikey: options.api_key
                        };
                    },
                    results: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data, page)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>Insert the null element at the beginning so that we
put the typed test as an option to create a new
content</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        data.splice(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, {title: <span class="hljs-string">''</span>, id: -<span class="hljs-number">1</span>});
                        <span class="hljs-keyword">return</span> {
                            results: data,
                            more: _.size(data)-<span class="hljs-number">1</span> === page_limit
                        };
                    }
                }
            });
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        form.ajax({</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>Aijack form submission.
Get the content being edited via the <code>edit_content</code>
attribute in the dialog (check the <code>`PositionView.edit_content</code>
method)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            beforeSubmit: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(arr)</span> {</span>
                <span class="hljs-keyword">var</span> content = block.content,
                    fields = lux.fields_from_array(arr),
                    wrapper = fields.wrapper;
                <span class="hljs-keyword">delete</span> fields.wrapper;
                content.replace(fields);
                block.wrapper = wrapper;
                block.set(content);
                dialog.fadeOut();
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
        });</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>Change content type in the view block</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        content_select.change(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> {</span>
            <span class="hljs-keyword">var</span> name = <span class="hljs-keyword">this</span>.value;</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>Try to get the content from the block content history</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            block.content = block.content_history[name];
            <span class="hljs-keyword">if</span> (!block.content) {
                <span class="hljs-keyword">var</span> ContentType = cms.content_type(name);
                <span class="hljs-keyword">if</span> (ContentType) {
                    block.content = <span class="hljs-keyword">new</span> ContentType();
                }
            }
            <span class="hljs-keyword">if</span> (block.content) {
                block.log(block + <span class="hljs-string">' changed content type to '</span> + block.content);
                block.content_history[block.content._meta.name] = block.content;
                <span class="hljs-keyword">if</span> (block.content._meta.persistent) {
                    fieldset_content.after(fieldset_dbfields);
                    block.content.updateForm(form.elem);
                } <span class="hljs-keyword">else</span> {
                    fieldset_dbfields.detach();
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>Get the form for content editing</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                content_data.html(<span class="hljs-string">''</span>);
                <span class="hljs-keyword">var</span> cform = block.content.getForm();
                content_data.append(cform.render().elem.children());
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (name) {
                web.logger.error(<span class="hljs-string">'Unknown content type '</span> + name);
            } <span class="hljs-keyword">else</span> {
                fieldset_dbfields.detach();
                content_data.html(<span class="hljs-string">''</span>);
            }
            <span class="hljs-keyword">if</span> (block.wrapper !== wrapper_select.val()) {
                wrapper_select.val(block.wrapper).trigger(<span class="hljs-string">'change'</span>);
            }
        });</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>Inject change content</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        dialog.set_current_view = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(view)</span> {</span>
            block = view;
            <span class="hljs-keyword">if</span> (block.content) {
                block.content_history[block.content._meta.name] = block.content;
                content_select.val(block.content._meta.name).trigger(<span class="hljs-string">'change'</span>);
            } <span class="hljs-keyword">else</span> {
                content_select.val(<span class="hljs-string">''</span>).trigger(<span class="hljs-string">'change'</span>);
            }
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> dialog;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span></pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>    views = cms.views = {},</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>    templateWidth = <span class="hljs-number">150</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>    selectRowTemplate = <span class="hljs-keyword">new</span> lux.ChoiceField(<span class="hljs-string">'rowtemplate'</span>, {
        choices: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> names = [];
            ROW_TEMPLATES.each(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(_, name)</span> {</span>
                names.push(name);
            });
            <span class="hljs-keyword">return</span> names;
        },
        select2: {
            placeholder: <span class="hljs-string">'Select a row layout'</span>,
            minimumResultsForSearch: -<span class="hljs-number">1</span>
        }
    }),</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>    selectBlockTemplate = <span class="hljs-keyword">new</span> lux.ChoiceField(<span class="hljs-string">'blocktemplate'</span>, {
        choices: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> names = [];
            BLOCK_TEMPLATES.each(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(_, name)</span> {</span>
                names.push(name);
            });
            <span class="hljs-keyword">return</span> names;
        },
        select2: {
            placeholder: <span class="hljs-string">'Select a block layout'</span>,
            minimumResultsForSearch: -<span class="hljs-number">1</span>
        }
    }),</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <h2 id="-contentview"> ContentView</h2>

            </div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p> Base <code>view</code> class for Lux CMS.
 The content view can be either in <code>editing</code> or <code>read</code> mode.
 When in editing mode the <code>this.options.editing</code> attribute is <code>true</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
    BaseContentView = views.base = lux.View.extend({</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>The constructor takes an HTML or jQuery element, an <code>options</code> object
and a <code>parent</code> ContentView.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        initialise: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(options)</span> {</span>
            <span class="hljs-keyword">this</span>.parentType = options.parent ? options.parent.type : <span class="hljs-literal">null</span>;
            <span class="hljs-keyword">delete</span> options.parent;
            <span class="hljs-keyword">this</span>.options = options;
            <span class="hljs-keyword">this</span>.store = <span class="hljs-keyword">this</span>.options.store;
            <span class="hljs-keyword">this</span>.name = <span class="hljs-keyword">this</span>.elem.data(<span class="hljs-string">'context'</span>);
            <span class="hljs-keyword">this</span>.elem.addClass(<span class="hljs-string">'cms-'</span> + <span class="hljs-keyword">this</span>.type).data(<span class="hljs-string">'cmsview'</span>, <span class="hljs-keyword">this</span>);
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>render the view and build children</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        render: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
            <span class="hljs-keyword">this</span>.elem.children().each(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                self.createChild(<span class="hljs-keyword">this</span>);
            });
            <span class="hljs-keyword">this</span>.elem.fadeTo(<span class="hljs-string">'fast'</span>, <span class="hljs-number">1</span>);
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>Setup the view for editing mode. Called during construction.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        setupEdit: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.childType &amp;&amp; !<span class="hljs-keyword">this</span>.editing) {
                _(<span class="hljs-keyword">this</span>.childrenElem()).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(elem)</span> {</span>
                    <span class="hljs-keyword">var</span> child = $(elem).data(<span class="hljs-string">'cmsview'</span>);
                    <span class="hljs-keyword">if</span> (child) {
                        child.setupEdit();
                    } <span class="hljs-keyword">else</span> {
                        self.log(<span class="hljs-string">'could not find editing element'</span>, <span class="hljs-string">'WARNING'</span>);
                    }
                });
            }
            <span class="hljs-keyword">this</span>.editing = <span class="hljs-literal">true</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>The parent view of this view.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        parent: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.parentType) {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.container().closest(<span class="hljs-string">'.cms-'</span>+<span class="hljs-keyword">this</span>.parentType).data(<span class="hljs-string">'cmsview'</span>);
            }
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>Fetch the child view at <code>index</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        child: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(index)</span> {</span>
            <span class="hljs-keyword">var</span> child;
            <span class="hljs-keyword">this</span>.iter(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(c, idx)</span> {</span>
                <span class="hljs-keyword">if</span> (idx === index) {
                    child = c;
                    <span class="hljs-keyword">return</span> lux.breaker;
                }
            });
            <span class="hljs-keyword">return</span> child;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>jQuery element containing all children</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        childrenElem: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.childType) {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.elem.find(<span class="hljs-string">'.cms-'</span> + <span class="hljs-keyword">this</span>.childType);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> [];
            }
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>Iterate over children views</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        iter: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(callback)</span> {</span>
            _(<span class="hljs-keyword">this</span>.childrenElem()).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(child, index)</span> {</span>
                callback($(child).data(<span class="hljs-string">'cmsview'</span>), index);
            });
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        page: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.parent().page();
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        grid: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.parent().grid();
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        current_column: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.page().current_column();
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>position within its parent</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        index: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> parent = <span class="hljs-keyword">this</span>.parent(),
                index = -<span class="hljs-number">1</span>,
                elem = <span class="hljs-keyword">this</span>.elem[<span class="hljs-number">0</span>];
            <span class="hljs-keyword">if</span> (parent) {
                _(parent.childrenElem()).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(c, idx)</span> {</span>
                    <span class="hljs-keyword">if</span> (elem === c) {
                        index = idx;
                        <span class="hljs-keyword">return</span> lux.breaker;
                    }
                });
            }
            <span class="hljs-keyword">return</span> index;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>Create child element and append it to this view</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        createChild: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(elem, content)</span> {</span>
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.childType) {
                <span class="hljs-keyword">var</span> View = views[<span class="hljs-keyword">this</span>.childType],
                    options = <span class="hljs-keyword">this</span>.options;
                <span class="hljs-keyword">if</span> (!View) {
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> lux.NotImplementedError(<span class="hljs-keyword">this</span> + <span class="hljs-string">' has no createChild method.'</span>);
                }
                options.elem = elem;
                options.parent = <span class="hljs-keyword">this</span>;
                <span class="hljs-keyword">var</span> child = <span class="hljs-keyword">new</span> View(options);
                <span class="hljs-keyword">if</span> (content === <span class="hljs-built_in">Object</span>(content)) {
                    child.elem.data(content);
                }
                child.render(<span class="hljs-keyword">this</span>);
                <span class="hljs-keyword">return</span> child;
            }
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p>The jQuery element containing this view.</p>
<p>It can be different form the view jQuery <code>elem</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        container: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.dialog ? <span class="hljs-keyword">this</span>.dialog.elem : <span class="hljs-keyword">this</span>.elem;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>Retrieve a column from the child at <code>index</code>. If index is not provided
or is out of bounds, retrieve the column from the first child</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        get_column: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(index)</span> {</span>
            <span class="hljs-keyword">var</span> child = <span class="hljs-keyword">this</span>.childrenElem().first(),
                view = child.data(<span class="hljs-string">'cmsview'</span>);
            <span class="hljs-keyword">return</span> view.get_column();
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p>Layout information for this view.</p>
<p>This method is invoked when a view needs to sync with the backend
database. By default a view returns an array containing the layout
information of its children.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        layout: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> all = [],
                layout;
            <span class="hljs-keyword">this</span>.iter(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(child)</span> {</span>
                layout = child.layout();
                <span class="hljs-keyword">if</span> (layout) all.push(layout);
            });
            <span class="hljs-keyword">return</span> all.length ? all : <span class="hljs-literal">null</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>Create dialog</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        _create_edit_dialog: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(opts)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.dialog) {
                <span class="hljs-keyword">this</span>.dialog = <span class="hljs-keyword">new</span> lux.Dialog(opts);
                <span class="hljs-keyword">this</span>.elem.before(<span class="hljs-keyword">this</span>.dialog.elem);
                <span class="hljs-keyword">this</span>.dialog.body().append(<span class="hljs-keyword">this</span>.elem);
            }
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.dialog;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        log: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(msg, lvl)</span> {</span>
            <span class="hljs-keyword">var</span> page = <span class="hljs-keyword">this</span>.page();
            <span class="hljs-keyword">if</span> (page &amp;&amp; page.logger) {
                <span class="hljs-keyword">if</span> (lvl) {
                    page.logger.html(<span class="hljs-string">'&lt;p class="text-danger"&gt;'</span> + lvl + <span class="hljs-string">': '</span> + msg + <span class="hljs-string">'&lt;/p&gt;'</span>);
                } <span class="hljs-keyword">else</span> {
                    page.logger.html(<span class="hljs-string">'&lt;p&gt;'</span> + msg + <span class="hljs-string">'&lt;/p&gt;'</span>);
                }
            }
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        toString: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> n = <span class="hljs-keyword">this</span>.index();
            <span class="hljs-keyword">return</span> n === -<span class="hljs-number">1</span> ? <span class="hljs-keyword">this</span>.type : <span class="hljs-keyword">this</span>.type + <span class="hljs-string">'-'</span> + n;
        }
    }),</pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <h2 id="-pageview"> PageView</h2>

            </div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <p> Handle the CMS page.
 This is the view which contains children <code>GridView</code>.
 GridView are created for all descendant which match the
 <code>.cms-grid</code> selector.
 A page does not add any child during editing, it is just a container
 of grid elements.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    PageView = views.page = BaseContentView.extend({
        type: <span class="hljs-string">'page'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        childType: <span class="hljs-string">'grid'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <p>Setup the view and build children which match cms</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        render: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
            <span class="hljs-keyword">this</span>.childrenElem().each(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                self.createChild(<span class="hljs-keyword">this</span>);
            });</pre></div></div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              <p>setup editing first</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.options.editing) {
                self.model = <span class="hljs-keyword">new</span> Page({id: <span class="hljs-keyword">this</span>.options.editing});
                <span class="hljs-keyword">this</span>.setupEdit();
            }
            <span class="hljs-keyword">this</span>.elem.fadeTo(<span class="hljs-number">100</span>, <span class="hljs-number">1</span>);
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              <p>Setup editing view</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        setupEdit: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.editing) {
                <span class="hljs-keyword">var</span> control = $(<span class="hljs-string">'.cms-control'</span>),
                    grid = <span class="hljs-keyword">new</span> lux.Grid({rows: [[<span class="hljs-number">8</span>,<span class="hljs-number">8</span>,<span class="hljs-number">8</span>]]});
                <span class="hljs-keyword">this</span>.logger = $(<span class="hljs-string">'&lt;div class="cms-info"&gt;&lt;/div&gt;'</span>);
                <span class="hljs-keyword">if</span> (!control.length) {
                    control = $(document.createElement(<span class="hljs-string">'div'</span>))
                        .addClass(<span class="hljs-string">'cms-control'</span>);
                }
                grid.row(<span class="hljs-number">0</span>).column(<span class="hljs-number">0</span>).append(control);
                <span class="hljs-keyword">this</span>.elem.prepend(grid.elem);
                <span class="hljs-keyword">this</span>.control = <span class="hljs-keyword">new</span> lux.Dialog(_.extend({
                    elem: grid.elem}, <span class="hljs-keyword">this</span>.options.page));
                <span class="hljs-keyword">this</span>.control.header().prepend(<span class="hljs-keyword">this</span>.logger);
                control.show();
                <span class="hljs-keyword">this</span>._add_block_control();</pre></div></div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              <p>Create Drag &amp; drop elements for the dialogs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.options.block.dragdrop) {
                    <span class="hljs-keyword">this</span>.options.block.dragdrop = <span class="hljs-keyword">this</span>._create_drag_drop(<span class="hljs-keyword">this</span>.options.block);
                }
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.options.row.dragdrop) {
                    <span class="hljs-keyword">this</span>.options.row.dragdrop = <span class="hljs-keyword">this</span>._create_drag_drop(<span class="hljs-keyword">this</span>.options.row);
                }
                <span class="hljs-keyword">this</span>._super();
            }
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        page: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        grid: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-94">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        index: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-95">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-95">&#182;</a>
              </div>
              <p>Return the current <code>ColumnView</code> element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        get_current_column: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._current_column;
        },
        set_current_column: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(column)</span> {</span>
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._current_column) {
                <span class="hljs-keyword">this</span>._current_column.elem.removeClass(<span class="hljs-string">'active'</span>);
            }
            <span class="hljs-keyword">this</span>._current_column = column;
            <span class="hljs-keyword">if</span> (column) {
                <span class="hljs-keyword">this</span>.log(<span class="hljs-string">'Selected current '</span> + column);
                column.elem.addClass(<span class="hljs-string">'active'</span>);
            }
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-96">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-96">&#182;</a>
              </div>
              <p>Returns an object rather than a list of children layouts</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        layout: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> all = {},
                layout;
            <span class="hljs-keyword">this</span>.iter(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(child)</span> {</span>
                layout = child.layout();
                <span class="hljs-keyword">if</span> (layout) all[child.name] = layout;
            });
            <span class="hljs-keyword">return</span> all;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-97">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-97">&#182;</a>
              </div>
              <p>Synchronise this view with the backend</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        sync: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
            <span class="hljs-keyword">this</span>.model.set(<span class="hljs-string">'content'</span>, <span class="hljs-keyword">this</span>.layout());
            <span class="hljs-keyword">this</span>.log(<span class="hljs-string">'saving layout...'</span>);
            self.model.sync(self.store, {
                success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    self.log(<span class="hljs-string">'Layout saved'</span>);
                }
            });
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-98">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-98">&#182;</a>
              </div>
              <p>Create the Add Block button for adding a block into a column.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        _add_block_control: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>,
                options = self.options,
                control = <span class="hljs-keyword">this</span>.control,
                button = control.createButton({
                    icon: options.add_block_icon,
                    title: <span class="hljs-string">'Add new block'</span>
                }),
                select = selectBlockTemplate.render(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(elem)</span> {</span>
                    self.control.buttons.prepend(elem);
                }).width(templateWidth);
            self.control.buttons.prepend(button.elem);
            button.elem.click(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                <span class="hljs-keyword">var</span> templateName = select.val(),
                    column = self.get_current_column();</pre></div></div>
            
        </li>
        
        
        <li id="section-99">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-99">&#182;</a>
              </div>
              <p>Add the block to the current column</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (!column || column.index() &lt; <span class="hljs-number">0</span>) {
                    column = self.get_column();
                    self.set_current_column(column);
                }
                <span class="hljs-keyword">if</span> (column) {
                    column.add_block(templateName);
                } <span class="hljs-keyword">else</span> {
                    self.log(<span class="hljs-string">'WARNING: No column available!'</span>);
                }
            });
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-100">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-100">&#182;</a>
              </div>
              <p>Enable drag and drop</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        _create_drag_drop: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(opts)</span> {</span>
            <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>,
                dd = <span class="hljs-keyword">new</span> lux.DragDrop({
                    dropzone: <span class="hljs-string">'.'</span> + opts.dropzone,
                    placeholder: $(document.createElement(<span class="hljs-string">'div'</span>)).addClass(opts.dropzone),
                    onDrop: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(elem, e)</span> {</span>
                        dd.moveElement(elem, <span class="hljs-keyword">this</span>);
                        self.sync();
                    }
                });
            dd.add(<span class="hljs-string">'.'</span> + opts.dropzone, <span class="hljs-string">'.'</span> + opts.dropzone + <span class="hljs-string">' &gt; .header'</span>);
            <span class="hljs-keyword">return</span> dd;
        }
    }),</pre></div></div>
            
        </li>
        
        
        <li id="section-101">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-101">&#182;</a>
              </div>
              <h2 id="gridview">GridView</h2>

            </div>
            
        </li>
        
        
        <li id="section-102">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-102">&#182;</a>
              </div>
              <p> View manager for an html grid.</p>

            </div>
            
        </li>
        
        
        <li id="section-103">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-103">&#182;</a>
              </div>
              <p> A grid is a container of rows.
 In editing mode it is used to add and remove rows.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    GridView = views.grid = BaseContentView.extend({
        type: <span class="hljs-string">'grid'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-104">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-104">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        childType: <span class="hljs-string">'row'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-105">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-105">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        setupEdit: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.editing) {
                <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>,
                    dialog = <span class="hljs-keyword">this</span>._create_edit_dialog(<span class="hljs-keyword">this</span>.options.grid),
                    add_row = dialog.createButton({
                        icon: <span class="hljs-keyword">this</span>.options.add_row_icon,
                        title: <span class="hljs-string">'Add new row'</span>
                    }),
                    select = selectRowTemplate.render(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(elem)</span> {</span>
                        dialog.buttons.prepend(elem);
                    }).width(templateWidth);</pre></div></div>
            
        </li>
        
        
        <li id="section-106">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-106">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>                dialog.elem.css(<span class="hljs-string">'margin-top'</span>, <span class="hljs-string">'5px'</span>);
                dialog.title(<span class="hljs-keyword">this</span>.name);
                dialog.buttons.prepend(add_row.elem);</pre></div></div>
            
        </li>
        
        
        <li id="section-107">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-107">&#182;</a>
              </div>
              <p>Adds a bright new row</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                add_row.elem.click(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    <span class="hljs-keyword">var</span> row = self.createChild(<span class="hljs-literal">null</span>, {template: select.val()});
                    self.elem.append(row.container());
                    row.setupEdit();
                });
                <span class="hljs-keyword">this</span>._super();
            }
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-108">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-108">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        grid: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-109">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-109">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        index: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.name;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-110">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-110">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        toString: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.type + <span class="hljs-string">'-'</span> + <span class="hljs-keyword">this</span>.name;
        }
    }),</pre></div></div>
            
        </li>
        
        
        <li id="section-111">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-111">&#182;</a>
              </div>
              <h2 id="-row-view"> Row View</h2>
<p> Rows are created with a prefixed number of Columns.
 They are rendered by the template chosen when the Row is created.
 Therefore no columns are added nor deleted once a Row is created.</p>
<ul>
<li>The number of children is fixed by the <code>template</code> attribute.</li>
<li>The <code>template</code> is retrieved from the <code>data-template</code>.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    RowView = views.row = BaseContentView.extend({
        type: <span class="hljs-string">'row'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-112">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-112">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        childType: <span class="hljs-string">'column'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-113">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-113">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        templates: ROW_TEMPLATES,</pre></div></div>
            
        </li>
        
        
        <li id="section-114">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-114">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        render: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.type == <span class="hljs-string">'row'</span>) {
                <span class="hljs-keyword">this</span>.elem.addClass(<span class="hljs-string">'row grid'</span> + <span class="hljs-keyword">this</span>.options.columns);
            }
            <span class="hljs-keyword">this</span>.templateName = <span class="hljs-keyword">this</span>.elem.data(<span class="hljs-string">'template'</span>);
            <span class="hljs-keyword">this</span>.template = <span class="hljs-keyword">this</span>.templateName ? <span class="hljs-keyword">this</span>.templates.get(<span class="hljs-keyword">this</span>.templateName) : <span class="hljs-literal">null</span>;
            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.template) {
                <span class="hljs-keyword">this</span>.templateName = <span class="hljs-keyword">this</span>.templates.order[<span class="hljs-number">0</span>];
                <span class="hljs-keyword">this</span>.template = <span class="hljs-keyword">this</span>.templates.get(<span class="hljs-keyword">this</span>.templateName);
            }
            <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>,
                num = <span class="hljs-keyword">this</span>.template.length,
                index = <span class="hljs-number">0</span>;

            <span class="hljs-keyword">this</span>.elem.children().detach().each(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                <span class="hljs-keyword">if</span> (index &lt; num) {
                    self.template.append(self.createChild(<span class="hljs-keyword">this</span>), self, index);
                    index += <span class="hljs-number">1</span>;
                }
            });</pre></div></div>
            
        </li>
        
        
        <li id="section-115">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-115">&#182;</a>
              </div>
              <p>Need more children for the template</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">for</span> (; index&lt;num; index++) {
                self.template.append(self.createChild(), self, index);
            }

        },</pre></div></div>
            
        </li>
        
        
        <li id="section-116">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-116">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        setupEdit: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">this</span>._create_edit_dialog(<span class="hljs-keyword">this</span>.options[<span class="hljs-keyword">this</span>.type]);
            <span class="hljs-keyword">this</span>._super();
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-117">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-117">&#182;</a>
              </div>
              <p>Serialise the layout of a row</p>
<ul>
<li>Keep the location of columns in a row.</li>
<li>If no columns have data skip the row</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>        layout: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> all = [],
                avail = <span class="hljs-literal">false</span>;
            _(<span class="hljs-keyword">this</span>.childrenElem()).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(child)</span> {</span>
                child = $(child).data(<span class="hljs-string">'cmsview'</span>);
                <span class="hljs-keyword">var</span> layout = child.layout();
                all.push(layout);
                <span class="hljs-keyword">if</span> (layout) avail = <span class="hljs-literal">true</span>;
            });
            <span class="hljs-keyword">if</span> (avail) {
                <span class="hljs-keyword">return</span> {
                    template: <span class="hljs-keyword">this</span>.templateName,
                    children: all
                };
            }
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-118">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-118">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        _create_edit_dialog: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(opts)</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.dialog) {
                <span class="hljs-keyword">var</span> dialog = <span class="hljs-keyword">this</span>._super(opts),
                    page = <span class="hljs-keyword">this</span>.page();
                dialog.elem.addClass(opts.dropzone).bind(<span class="hljs-string">'removed'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    <span class="hljs-keyword">if</span> (page) {
                        page.sync();
                    }
                });
            }
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.dialog;
        },
    }),</pre></div></div>
            
        </li>
        
        
        <li id="section-119">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-119">&#182;</a>
              </div>
              <h2 id="-column-view"> Column View</h2>
<p> Handle the A Column within a Row.
 A column is a container of several Blocks vertically aligned.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ColumnView = views.column = BaseContentView.extend({
        type: <span class="hljs-string">'column'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-120">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-120">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        childType: <span class="hljs-string">'block'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-121">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-121">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        setupEdit: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.editing) {
                <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
                <span class="hljs-keyword">this</span>.elem.click(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    self.page().set_current_column(self);
                });
                <span class="hljs-keyword">this</span>._super();
            }
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-122">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-122">&#182;</a>
              </div>
              <p>Return self</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        get_column: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-123">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-123">&#182;</a>
              </div>
              <p>Add a new block to the column</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        add_block: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(templateName)</span> {</span>
            <span class="hljs-keyword">var</span> child = <span class="hljs-keyword">this</span>.createChild(<span class="hljs-literal">null</span>, {template: templateName});
            <span class="hljs-keyword">this</span>.elem.append(child.container());
            <span class="hljs-keyword">this</span>.log(<span class="hljs-string">'Added new '</span> + child);
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.editing) {
                child.setupEdit();
            }
        }
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-124">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-124">&#182;</a>
              </div>
              <h2 id="-block-view"> Block View</h2>
<p> The Block View inherits from the <code>RowView</code>.
 Blocks are displaied within a ColumnView in
 a vertical layout.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> BlockView = views.block = RowView.extend({
        type: <span class="hljs-string">'block'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-125">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-125">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        childType: <span class="hljs-string">'content'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-126">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-126">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        templates: BLOCK_TEMPLATES,</pre></div></div>
            
        </li>
        
        
        <li id="section-127">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-127">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        get_column: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.parent();
        }
    }),</pre></div></div>
            
        </li>
        
        
        <li id="section-128">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-128">&#182;</a>
              </div>
              <h2 id="content-view">Content View</h2>

            </div>
            
        </li>
        
        
        <li id="section-129">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-129">&#182;</a>
              </div>
              <p> The view for contents and therefore the atom of lux CMS.</p>

            </div>
            
        </li>
        
        
        <li id="section-130">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-130">&#182;</a>
              </div>
              <p> The content can be either retrieved via a backend (when in editing mode)
 or accessed via children elements when in read mode. Childern elements
 have the <code>field</code> entry in their html data attribute. The field contains
 the name of the field for which the inner html of the element provides value.</p>
<p> <a href="#inline-editing">Inline editing</a> is available when in editing mode.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ContentView = views.content = BaseContentView.extend({
        type: <span class="hljs-string">'content'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-131">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-131">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        render: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>,
                data = <span class="hljs-keyword">this</span>.elem.data(),
                Content = lux.cms.content_type(data.content_type),
                content;
            <span class="hljs-keyword">if</span> (Content) {</pre></div></div>
            
        </li>
        
        
        <li id="section-132">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-132">&#182;</a>
              </div>
              <p>remove the content_type &amp; cmsview</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">this</span>.wrapper = data.wrapper;
                <span class="hljs-keyword">this</span>.skin = data.skin;
                data = _.merge({}, data);
                <span class="hljs-keyword">delete</span> data.wrapper;
                <span class="hljs-keyword">delete</span> data.skin;
                <span class="hljs-keyword">delete</span> data.cmsview;
                <span class="hljs-keyword">this</span>.elem.children().each(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    <span class="hljs-keyword">var</span> elem = $(<span class="hljs-keyword">this</span>),
                        field = elem.data(<span class="hljs-string">'field'</span>);
                    <span class="hljs-keyword">if</span> (field) {
                        data[field] = elem.html();
                    } <span class="hljs-keyword">else</span> {
                        self.log(<span class="hljs-string">'Field not available in content'</span>, <span class="hljs-string">'WARNING'</span>);
                    }
                });
                <span class="hljs-keyword">if</span> (!data.keywords) data.keywords = [];
                <span class="hljs-keyword">this</span>.set(<span class="hljs-keyword">new</span> Content(data), <span class="hljs-literal">false</span>);
            }
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-133">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-133">&#182;</a>
              </div>
              <p>Setup the editing view by adding the edit button which trigger the
<code>edit_content</code> method when clicked.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        setupEdit: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.editing) {
                <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>,
                    container = $(document.createElement(<span class="hljs-string">'div'</span>)),
                    toolbar = $(document.createElement(<span class="hljs-string">'div'</span>))
                                .addClass(<span class="hljs-string">'cms-content-toolbar'</span>).appendTo(container),
                    group = $(document.createElement(<span class="hljs-string">'div'</span>))
                                .addClass(<span class="hljs-string">'btn-group pull-right'</span>).appendTo(toolbar),
                    parent = <span class="hljs-keyword">this</span>.parent(),
                    button = parent.dialog.createButton({icon: <span class="hljs-string">'edit'</span>, size: <span class="hljs-string">'mini'</span>});
                button.elem.click(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    self.edit_content();
                }).appendTo(group);
                <span class="hljs-keyword">this</span>.button_group = group;
                <span class="hljs-keyword">this</span>.title = $(document.createElement(<span class="hljs-string">'span'</span>)).prependTo(toolbar);
                container.appendTo(<span class="hljs-keyword">this</span>.elem.parent());
                <span class="hljs-keyword">this</span>.elem.addClass(<span class="hljs-string">'preview'</span>).appendTo(container);
                <span class="hljs-keyword">this</span>._container = container;
                <span class="hljs-keyword">this</span>.content_history = {};
                <span class="hljs-keyword">this</span>.editing = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.content) {
                    <span class="hljs-keyword">this</span>.title.html(<span class="hljs-keyword">this</span>.content._meta.title);
                }
            }
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-134">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-134">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        container: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._container ? <span class="hljs-keyword">this</span>._container : <span class="hljs-keyword">this</span>.elem;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-135">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-135">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        child: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(index)</span> {</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-136">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-136">&#182;</a>
              </div>
              <p>Retrieve content from backend when in editing mode, otherwise
set the fields obtained from subelements in the <code>createChild</code> method.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        get_content: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(ct)</span> {</span>
            <span class="hljs-keyword">var</span> ContentType = lux.cms.content_type(ct.content_type),
                self = <span class="hljs-keyword">this</span>;
            <span class="hljs-keyword">if</span> (ContentType) {
                <span class="hljs-keyword">var</span> fields = <span class="hljs-keyword">this</span>.elem.data(<span class="hljs-string">'fields'</span>);
                <span class="hljs-keyword">if</span> (ct.fields || fields === <span class="hljs-number">0</span>) {
                    fields = ct.fields;
                    <span class="hljs-keyword">if</span> (ct.id) {
                        fields = fields || {};
                        fields.id = ct.id;
                    }
                    <span class="hljs-keyword">this</span>.set(<span class="hljs-keyword">new</span> ContentType(fields), <span class="hljs-literal">false</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-137">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-137">&#182;</a>
              </div>
              <p>If id given, needs to load the content</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ct.id) {
                    ContentType._meta.get(ct.id, {
                        success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data)</span> {</span>
                            self.set(data[<span class="hljs-number">0</span>], <span class="hljs-literal">false</span>);
                        }
                    });
                } <span class="hljs-keyword">else</span> {
                   self.log(<span class="hljs-string">'could not understand content!'</span>, <span class="hljs-string">'WARNING'</span>);
                }
            }
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-138">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-138">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        layout: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.content) {
                <span class="hljs-keyword">return</span> {
                    content: <span class="hljs-keyword">this</span>.content.serialize(),
                    skin: <span class="hljs-keyword">this</span>.skin,
                    wrapper: <span class="hljs-keyword">this</span>.wrapper
                };
            }
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-139">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-139">&#182;</a>
              </div>
              <p>Set the <code>content</code> for this Content View.
When <code>sync</code> is not <code>false</code>
the content is synchronised with the backend (editing mode).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        set: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(content, sync)</span> {</span>
            <span class="hljs-keyword">this</span>.content = content;
            <span class="hljs-keyword">var</span> wrapper = cms.wrapper_type(<span class="hljs-keyword">this</span>.wrapper);
            <span class="hljs-keyword">this</span>.elem.html(<span class="hljs-string">''</span>);
            <span class="hljs-keyword">if</span> (wrapper) {
                wrapper.render(<span class="hljs-keyword">this</span>);
            } <span class="hljs-keyword">else</span> {
                content.render(<span class="hljs-keyword">this</span>.elem, <span class="hljs-keyword">this</span>.skin);
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-140">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-140">&#182;</a>
              </div>
              <p>Set the toolbar title if in editing mode</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.title) {
                <span class="hljs-keyword">this</span>.title.html(content._meta.title);
            }
            <span class="hljs-keyword">if</span> (sync !== <span class="hljs-literal">false</span>) {
                <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>,
                    page = <span class="hljs-keyword">this</span>.page();</pre></div></div>
            
        </li>
        
        
        <li id="section-141">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-141">&#182;</a>
              </div>
              <p>save the content if it needs to be saved</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                content.sync(self.store, {
                    success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                        self.log(self + <span class="hljs-string">' set content to '</span> + self.content);
                        page.sync();
                    },
                    error: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(status)</span> {</span>
                        self.log(<span class="hljs-string">'ERROR while synching. '</span> + status);
                    }
                });
            }
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-142">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-142">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        get_column: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.parent.get_column();
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-143">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-143">&#182;</a>
              </div>
              <p>Edit content by opening a dialog.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        edit_content: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> root = <span class="hljs-keyword">this</span>.page(),
                dialog = root._content_dialog;
            <span class="hljs-keyword">if</span> (!dialog) {
                dialog = edit_content_dialog(root.options);
                root._content_dialog = dialog;
            }
            dialog.set_current_view(<span class="hljs-keyword">this</span>);
            dialog.fadeIn();
            <span class="hljs-keyword">return</span> dialog;
        }
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-144">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-144">&#182;</a>
              </div>
              <h2 id="-cms-layouts"> CMS Layouts</h2>
<p> The <code>Layout</code> is the base class from Block Layouts. Each layouts has
 the <code>length</code> attribute which defines the number of elements
 within the layout.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> Layout = lux.Class.extend({</pre></div></div>
            
        </li>
        
        
        <li id="section-145">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-145">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        init: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(length)</span> {</span>
            <span class="hljs-keyword">this</span>.length = length;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-146">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-146">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        append: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(pos, block, index)</span> {</span>
            <span class="hljs-keyword">var</span> elem = pos.container();
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.length === <span class="hljs-number">1</span>) {
                block.elem.append(elem);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">var</span> inner = block.inner;
                <span class="hljs-keyword">if</span> (!block.elem.children().length) {
                    block.elem.addClass(<span class="hljs-string">'row grid'</span>+block.options.columns);
                }
                elem.addClass(<span class="hljs-string">'span'</span> + block.options.columns/<span class="hljs-keyword">this</span>.length).appendTo(block.elem);
            }
        }
    });

    <span class="hljs-keyword">var</span> Tabs = Layout.extend({
        append: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(pos, block, index)</span> {</span>
            <span class="hljs-keyword">var</span> elem = pos.container();
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.length === <span class="hljs-number">1</span>) {
                block.elem.append(elem);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">var</span> inner = block.inner,
                    href = lux.s4(),
                    title = pos.elem.attr(<span class="hljs-string">'title'</span>),
                    a = $(document.createElement(<span class="hljs-string">'a'</span>)).attr(<span class="hljs-string">'href'</span>, <span class="hljs-string">'#'</span>+href).html(title);
                <span class="hljs-keyword">if</span> (!inner) {
                    block.ul = $(document.createElement(<span class="hljs-string">'ul'</span>)).appendTo(block.elem);
                    block.inner = inner = $(document.createElement(<span class="hljs-string">'div'</span>)).appendTo(block.elem);
                }
                block.ul.append($(document.createElement(<span class="hljs-string">'li'</span>)).append(a));
                block.inner.append($(document.createElement(<span class="hljs-string">'div'</span>)).attr(<span class="hljs-string">'id'</span>, href).append(elem));
            }
        }
    });

    <span class="hljs-keyword">var</span> RowTemplate = lux.Class.extend({</pre></div></div>
            
        </li>
        
        
        <li id="section-147">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-147">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        init: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(splits)</span> {</span>
            <span class="hljs-keyword">this</span>.splits = splits;
            <span class="hljs-keyword">this</span>.length = splits.length;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-148">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-148">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        append: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(child, parent, index)</span> {</span>
            <span class="hljs-keyword">var</span> elem = child.container();
            elem.addClass(<span class="hljs-string">'column span'</span> + <span class="hljs-keyword">this</span>.splits[index]*parent.options.columns);
            parent.elem.append(elem);
        }
    });


    ROW_TEMPLATES.set(<span class="hljs-string">'One Column'</span>, <span class="hljs-keyword">new</span> RowTemplate([<span class="hljs-number">1</span>]));
    ROW_TEMPLATES.set(<span class="hljs-string">'Half-Half'</span>, <span class="hljs-keyword">new</span> RowTemplate([<span class="hljs-number">1</span>/<span class="hljs-number">2</span>, <span class="hljs-number">1</span>/<span class="hljs-number">2</span>]));
    ROW_TEMPLATES.set(<span class="hljs-string">'33-66'</span>, <span class="hljs-keyword">new</span> RowTemplate([<span class="hljs-number">1</span>/<span class="hljs-number">3</span>, <span class="hljs-number">2</span>/<span class="hljs-number">3</span>]));
    ROW_TEMPLATES.set(<span class="hljs-string">'66-33'</span>, <span class="hljs-keyword">new</span> RowTemplate([<span class="hljs-number">2</span>/<span class="hljs-number">3</span>, <span class="hljs-number">1</span>/<span class="hljs-number">3</span>]));
    ROW_TEMPLATES.set(<span class="hljs-string">'25-75'</span>, <span class="hljs-keyword">new</span> RowTemplate([<span class="hljs-number">1</span>/<span class="hljs-number">4</span>, <span class="hljs-number">3</span>/<span class="hljs-number">4</span>]));
    ROW_TEMPLATES.set(<span class="hljs-string">'75-25'</span>, <span class="hljs-keyword">new</span> RowTemplate([<span class="hljs-number">3</span>/<span class="hljs-number">4</span>, <span class="hljs-number">1</span>/<span class="hljs-number">4</span>]));

    ROW_TEMPLATES.set(<span class="hljs-string">'33-33-33'</span>, <span class="hljs-keyword">new</span> RowTemplate([<span class="hljs-number">1</span>/<span class="hljs-number">3</span>, <span class="hljs-number">1</span>/<span class="hljs-number">3</span>, <span class="hljs-number">1</span>/<span class="hljs-number">3</span>]));
    ROW_TEMPLATES.set(<span class="hljs-string">'50-25-25'</span>, <span class="hljs-keyword">new</span> RowTemplate([<span class="hljs-number">1</span>/<span class="hljs-number">2</span>, <span class="hljs-number">1</span>/<span class="hljs-number">4</span>, <span class="hljs-number">1</span>/<span class="hljs-number">4</span>]));
    ROW_TEMPLATES.set(<span class="hljs-string">'25-25-50'</span>, <span class="hljs-keyword">new</span> RowTemplate([<span class="hljs-number">1</span>/<span class="hljs-number">4</span>, <span class="hljs-number">1</span>/<span class="hljs-number">4</span>, <span class="hljs-number">1</span>/<span class="hljs-number">2</span>]));
    ROW_TEMPLATES.set(<span class="hljs-string">'25-50-25'</span>, <span class="hljs-keyword">new</span> RowTemplate([<span class="hljs-number">1</span>/<span class="hljs-number">4</span>, <span class="hljs-number">1</span>/<span class="hljs-number">2</span>, <span class="hljs-number">1</span>/<span class="hljs-number">4</span>]));

    ROW_TEMPLATES.set(<span class="hljs-string">'25-25-25-25'</span>, <span class="hljs-keyword">new</span> RowTemplate([<span class="hljs-number">1</span>/<span class="hljs-number">4</span>, <span class="hljs-number">1</span>/<span class="hljs-number">4</span>, <span class="hljs-number">1</span>/<span class="hljs-number">4</span>, <span class="hljs-number">1</span>/<span class="hljs-number">4</span>]));


    BLOCK_TEMPLATES.set(<span class="hljs-string">'1 element'</span>, <span class="hljs-keyword">new</span> Layout(<span class="hljs-number">1</span>));
    BLOCK_TEMPLATES.set(<span class="hljs-string">'2 elements'</span>, <span class="hljs-keyword">new</span> Layout(<span class="hljs-number">2</span>));
    BLOCK_TEMPLATES.set(<span class="hljs-string">'3 elements'</span>, <span class="hljs-keyword">new</span> Layout(<span class="hljs-number">3</span>));
    BLOCK_TEMPLATES.set(<span class="hljs-string">'2 tabs'</span>, <span class="hljs-keyword">new</span> Tabs(<span class="hljs-number">2</span>));
    BLOCK_TEMPLATES.set(<span class="hljs-string">'3 tabs'</span>, <span class="hljs-keyword">new</span> Tabs(<span class="hljs-number">3</span>));
    BLOCK_TEMPLATES.set(<span class="hljs-string">'4 tabs'</span>, <span class="hljs-keyword">new</span> Tabs(<span class="hljs-number">4</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-149">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-149">&#182;</a>
              </div>
              <h2 id="-default-cms-wrappers"> Default CMS Wrappers</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>
    <span class="hljs-keyword">var</span> _panel = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(view, with_header, with_title)</span> {</span>
        <span class="hljs-keyword">var</span> outer = $(<span class="hljs-string">"&lt;div class='panel panel-default'&gt;&lt;/div&gt;"</span>).appendTo(view.elem).addClass(view.skin);
        <span class="hljs-keyword">if</span> (with_header) {
            <span class="hljs-keyword">var</span> head = $(<span class="hljs-string">"&lt;div class='header'&gt;&lt;/div&gt;"</span>).appendTo(outer),
                title = view.content.get(<span class="hljs-string">'title'</span>);
            <span class="hljs-keyword">if</span> (with_title) {
                head = $(<span class="hljs-string">"&lt;h3 class='title'&gt;&lt;/h3&gt;"</span>).appendTo(head);
            }
            <span class="hljs-keyword">if</span> (title) {
                head.html(title);
            }
        }
        <span class="hljs-keyword">var</span> elem = $(<span class="hljs-string">"&lt;div class='body'&gt;&lt;/div&gt;"</span>).appendTo(outer);
        view.content.render(elem, view.skin);
    };


    cms.create_wrapper(<span class="hljs-string">'nothing'</span>, {
        title: <span class="hljs-string">'No Wrapper'</span>
    });

    cms.create_wrapper(<span class="hljs-string">'well'</span>, {
        title: <span class="hljs-string">'Well'</span>,
        render: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(view)</span> {</span>
            <span class="hljs-keyword">var</span> elem = $(<span class="hljs-string">"&lt;div class='well'&gt;&lt;/div&gt;"</span>).appendTo(view.elem);
            view.content.render(elem);
        }
    });

    cms.create_wrapper(<span class="hljs-string">'welllg'</span>, {
        title: <span class="hljs-string">'Well Large'</span>,
        render: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(view)</span> {</span>
            <span class="hljs-keyword">var</span> elem = $(<span class="hljs-string">"&lt;div class='well well-lg'&gt;&lt;/div&gt;"</span>).appendTo(view.elem).addClass(view.skin);
            view.content.render(elem);
        }
    });

    cms.create_wrapper(<span class="hljs-string">'wellsm'</span>, {
        title: <span class="hljs-string">'Well Small'</span>,
        render: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(view)</span> {</span>
            <span class="hljs-keyword">var</span> elem = $(<span class="hljs-string">"&lt;div class='well well-sm'&gt;&lt;/div&gt;"</span>).appendTo(view.elem).addClass(view.skin);
            view.content.render(elem);
        }
    });

    cms.create_wrapper(<span class="hljs-string">'panel'</span>, {
        title: <span class="hljs-string">'Panel'</span>,
        render: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(view)</span> {</span>
            _panel(view);
        }
    });

    cms.create_wrapper(<span class="hljs-string">'panelheading'</span>, {
        title: <span class="hljs-string">'Panel with heading'</span>,
        render: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(view)</span> {</span>
            _panel(view, <span class="hljs-literal">true</span>);
        }
    });

    cms.create_wrapper(<span class="hljs-string">'paneltitle'</span>, {
        title: <span class="hljs-string">'Panel with title'</span>,
        render: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(view)</span> {</span>
            _panel(view, <span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>);
        }
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-150">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-150">&#182;</a>
              </div>
              <h2 id="-default-cms-contents"> Default CMS Contents</h2>
<p> The following are the default CMS contents shipped with lux <code>cms</code>
 distribution. The are created by invoking the
 lux.cms.create_content_type`` function.</p>

            </div>
            
        </li>
        
        
        <li id="section-151">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-151">&#182;</a>
              </div>
              <h2 id="-this-content"> This Content</h2>
<p> The first a probably most important content type. It represents
 the response obtained by the backend server without the cms
 system in place.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    cms.create_content_type(<span class="hljs-string">'contenturl'</span>, {
        meta: {
            title: <span class="hljs-string">'Site Content'</span>,
            fields: [
                <span class="hljs-keyword">new</span> lux.ChoiceField(<span class="hljs-string">'content_url'</span>, {
                    label: <span class="hljs-string">'Choose a content'</span>,
                    choices: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                        <span class="hljs-keyword">var</span> vals = [];
                        _(lux.content_urls).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(value)</span> {</span>
                            vals.push(value);
                        });
                        <span class="hljs-keyword">return</span> vals;
                    }
                })
            ]
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-152">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-152">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        render: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(container, skin)</span> {</span>
            <span class="hljs-keyword">var</span> url = <span class="hljs-keyword">this</span>.get(<span class="hljs-string">'content_url'</span>);
            <span class="hljs-keyword">if</span> (url === <span class="hljs-string">'this'</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-153">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-153">&#182;</a>
              </div>
              <p>defer to later</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">var</span> html = <span class="hljs-keyword">this</span>.get(<span class="hljs-string">'this'</span>);
                _.defer(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    lux.loadViews(container.html(html));
                });
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (url) {
                container.html(<span class="hljs-string">'&amp;nbsp;'</span>);
                $.ajax(url, {
                    dataType: <span class="hljs-string">'json'</span>,
                    success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data, status, xhr)</span> {</span>
                        <span class="hljs-keyword">if</span> (data.html) {
                            <span class="hljs-built_in">require</span>(data.requires || [], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                                lux.loadViews(container.html(data.html));
                            });
                        }
                    }
                });
            } <span class="hljs-keyword">else</span> {
                logger.warning(<span class="hljs-string">'Missing underlying page url and html'</span>);
            }
        }
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-154">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-154">&#182;</a>
              </div>
              <h2 id="-blank-content"> Blank Content</h2>
<p> Insert a non-breaking space.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    cms.create_content_type(<span class="hljs-string">'blank'</span>, {
        model_title: <span class="hljs-string">'The content served by the url'</span>,
        render: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(container)</span> {</span>
            container.html(<span class="hljs-string">'&amp;nbsp;'</span>);
        }
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-155">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-155">&#182;</a>
              </div>
              <h2 id="-markdown"> Markdown</h2>
<p> Insert a non-breaking space.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    cms.create_content_type(<span class="hljs-string">'markdown'</span>, {</pre></div></div>
            
        </li>
        
        
        <li id="section-156">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-156">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        meta: {
            title: <span class="hljs-string">'Text using markdown'</span>,
            persistent: <span class="hljs-literal">true</span>,
            fields: [
                <span class="hljs-keyword">new</span> lux.TextArea(<span class="hljs-string">'raw'</span>, {
                    rows: <span class="hljs-number">10</span>,
                    placeholder: <span class="hljs-string">'Write markdown'</span>
                }),
                <span class="hljs-keyword">new</span> lux.TextArea(<span class="hljs-string">'javascript'</span>, {
                    rows: <span class="hljs-number">7</span>,
                    placeholder: <span class="hljs-string">'javascript'</span>
                })
            ]
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-157">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-157">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        render: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(container)</span> {</span>
            <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
            <span class="hljs-built_in">require</span>([<span class="hljs-string">'showdown'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                <span class="hljs-keyword">var</span> raw = self.get(<span class="hljs-string">'raw'</span>) || <span class="hljs-string">''</span>,
                    js = self.get(<span class="hljs-string">'javascript'</span>) || <span class="hljs-string">''</span>,
                    converter = <span class="hljs-keyword">new</span> Showdown.converter(),
                    html = converter.makeHtml(raw);
                lux.loadViews(container.html(html));
                <span class="hljs-keyword">if</span> (js) {
                    <span class="hljs-keyword">var</span> b = $(<span class="hljs-string">'body'</span>),
                        script = $(<span class="hljs-string">"&lt;script type='application/javascript'&gt;"</span> + js + <span class="hljs-string">"&lt;/script&gt;"</span>),
                        cid = self.cid();
                    $(<span class="hljs-string">'#'</span> + cid, b).remove();
                    b.append(script.attr(<span class="hljs-string">'id'</span>, cid));
                }
            });
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-158">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-158">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        get_form_new: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(callback)</span> {</span>
            <span class="hljs-keyword">var</span> f = <span class="hljs-keyword">this</span>._meta.fields,
                form = lux.web.form(),
                raw = f.raw.add_to_form(form, <span class="hljs-keyword">this</span>),
                js = f.javascript.add_to_form(form, <span class="hljs-keyword">this</span>),
                tabs = <span class="hljs-keyword">new</span> lux.TabView({tabs: [
                    {
                        name: <span class="hljs-string">'markdown'</span>,
                        content: raw
                    },
                    {
                        name: <span class="hljs-string">'javascript'</span>,
                        content: js
                    }]
                });
            form._element.empty().append(tabs.elem);
            <span class="hljs-built_in">require</span>([<span class="hljs-string">'codemirror'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                CodeMirror.fromTextArea(raw[<span class="hljs-number">0</span>]);
                CodeMirror.fromTextArea(js[<span class="hljs-number">0</span>]);
                callback(form);
            });
        }
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-159">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-159">&#182;</a>
              </div>
              <h2 id="-versions"> Versions</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>    cms.create_content_type(<span class="hljs-string">'versions'</span>, {
        meta: {
            title: <span class="hljs-string">'Versions of libraries'</span>
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-160">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-160">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        render: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(container)</span> {</span>
            <span class="hljs-keyword">var</span> ul = $(document.createElement(<span class="hljs-string">'ul'</span>)).appendTo(container);
            _(lux.libraries).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(lib)</span> {</span>
                ul.append($(<span class="hljs-string">'&lt;li&gt;&lt;a href="'</span> + lib.web + <span class="hljs-string">'"&gt;'</span> + lib.name +
                            <span class="hljs-string">'&lt;/a&gt; '</span> + lib.version + <span class="hljs-string">'&lt;/li&gt;'</span>));
            });
        }
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-161">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-161">&#182;</a>
              </div>
              <h2 id="-datatable"> Datatable</h2>

            </div>
            
        </li>
        
        
        <li id="section-162">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-162">&#182;</a>
              </div>
              <p>Data table for models allows to build highly configurable tables or grids
which represents collections of models.</p>
<p>THis content is available only when lux provide an api for models in the
html tag via the <code>api</code> data key.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    cms.create_content_type(<span class="hljs-string">'datatable'</span>, {</pre></div></div>
            
        </li>
        
        
        <li id="section-163">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-163">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        meta: {
            title: <span class="hljs-string">'Data Grid'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-164">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-164">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>            persistent: <span class="hljs-literal">true</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-165">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-165">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>            render_queue: [],</pre></div></div>
            
        </li>
        
        
        <li id="section-166">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-166">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>            api_info: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(api)</span> {</span>
                <span class="hljs-keyword">this</span>.api = api || {};
                <span class="hljs-keyword">var</span> queue = <span class="hljs-keyword">this</span>.render_queue;
                <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.render_queue;
                _.each(queue, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
                    o.content._render(o.container, o.skin);
                });
            },</pre></div></div>
            
        </li>
        
        
        <li id="section-167">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-167">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>            fields: [
                <span class="hljs-keyword">new</span> lux.ChoiceField(<span class="hljs-string">'url'</span>, {
                    label: <span class="hljs-string">'Choose a model'</span>,
                    choices: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(form)</span> {</span>
                        <span class="hljs-keyword">var</span> api = form.model.api();
                        <span class="hljs-keyword">return</span> api.groups;
                    },
                    select2: {}
                }),
                <span class="hljs-keyword">new</span> lux.MultiField(<span class="hljs-string">'fields'</span>, {
                    placeholder: <span class="hljs-string">'Select fields to display'</span>,
                    select2: {}
                }),
                <span class="hljs-keyword">new</span> lux.MultiField(<span class="hljs-string">'row_actions'</span>, {
                    label: <span class="hljs-string">'Row actions'</span>,
                    placeholder: <span class="hljs-string">'Action on rows'</span>,
                    choices: [{value: <span class="hljs-string">'delete'</span>}],
                    select2: {
                        minimumResultsForSearch: -<span class="hljs-number">1</span>
                    }
                }),
                <span class="hljs-keyword">new</span> lux.ChoiceField(<span class="hljs-string">'style'</span>, {
                    tag: <span class="hljs-string">'input'</span>,
                    choices: [<span class="hljs-string">'table'</span>, <span class="hljs-string">'grid'</span>]
                }),
                <span class="hljs-keyword">new</span> lux.BooleanField(<span class="hljs-string">'sortable'</span>),
                <span class="hljs-keyword">new</span> lux.BooleanField(<span class="hljs-string">'editable'</span>),
                <span class="hljs-keyword">new</span> lux.BooleanField(<span class="hljs-string">'collapsable'</span>),
                <span class="hljs-keyword">new</span> lux.BooleanField(<span class="hljs-string">'fullscreen'</span>),
                <span class="hljs-keyword">new</span> lux.BooleanField(<span class="hljs-string">'footer'</span>, {
                    label: <span class="hljs-string">'Display Footer'</span>
                })
            ]
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-168">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-168">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        render: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(container, skin)</span> {</span>
            <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
            <span class="hljs-built_in">require</span>([<span class="hljs-string">'datagrid'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                <span class="hljs-keyword">if</span> (self._meta.api === <span class="hljs-literal">undefined</span>) {
                    self._meta.render_queue.push({
                        content: self,
                        <span class="hljs-string">'container'</span>: container,
                        <span class="hljs-string">'skin'</span>: skin
                    });
                } <span class="hljs-keyword">else</span> {
                    self._render(container, skin);
                }
            });
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-169">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-169">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        getForm: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> form = <span class="hljs-keyword">this</span>._super();
            <span class="hljs-keyword">this</span>._formActions(form);
            <span class="hljs-keyword">return</span> form;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-170">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-170">&#182;</a>
              </div>
              <p>Internal methods</p>

            </div>
            
        </li>
        
        
        <li id="section-171">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-171">&#182;</a>
              </div>
              <p>Actually does the datagrid rendering</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        _render: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(container, skin)</span> {</span>
            <span class="hljs-keyword">var</span> elem = $(document.createElement(<span class="hljs-string">'div'</span>)).appendTo(container),
                options = _.extend({}, <span class="hljs-keyword">this</span>.fields()),
                models = <span class="hljs-keyword">this</span>.api().models,
                model = models ? models[options.url] : <span class="hljs-literal">null</span>,
                headers = [];
            <span class="hljs-keyword">if</span> (model) {
                <span class="hljs-keyword">if</span> (options.fields) {
                    <span class="hljs-keyword">var</span> available_fields = {};
                    _(model.fields).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(elem)</span> {</span>
                        available_fields[elem.code] = elem;
                    });
                    _(options.fields).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(code)</span> {</span>
                        <span class="hljs-keyword">var</span> head = available_fields[code];
                        <span class="hljs-keyword">if</span> (head) {
                            headers.push(head);
                        }
                    });
                }
                <span class="hljs-keyword">if</span> (headers.length) {
                    options.columns = headers;
                } <span class="hljs-keyword">else</span> {
                    options.columns = model.fields;
                }
                options.store = options.url;
                options.skin = skin;
                elem.datagrid(options);
            }
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-172">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-172">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        api: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> api = <span class="hljs-keyword">this</span>._meta.api;
            <span class="hljs-keyword">if</span> (api) {
                <span class="hljs-keyword">if</span> (!api.groups &amp;&amp; api.sitemap) {
                    <span class="hljs-keyword">this</span>._create_groups(api);
                }
                <span class="hljs-keyword">return</span> api;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> {};
            }
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-173">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-173">&#182;</a>
              </div>
              <p>sitemap is a list of api section handlers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        _create_groups: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(api)</span> {</span>
            <span class="hljs-keyword">var</span> groups = [],
                models = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-174">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-174">&#182;</a>
              </div>
              <p>Add options to the model select widgets</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            _(api.sitemap).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(section)</span> {</span>
                <span class="hljs-keyword">var</span> group = $(document.createElement(<span class="hljs-string">'optgroup'</span>)).attr(
                    <span class="hljs-string">'label'</span>, section.name);
                groups.push(group);
                _(section.routes).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(route)</span> {</span>
                    $(document.createElement(<span class="hljs-string">'option'</span>))
                        .val(route.api_url).html(route.model).appendTo(group);</pre></div></div>
            
        </li>
        
        
        <li id="section-175">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-175">&#182;</a>
              </div>
              <p>Add the route to the models object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    models[route.api_url] = route;
                });
            });
            api.groups = groups;
            api.models = models;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-176">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-176">&#182;</a>
              </div>
              <p>Add action to the datagrid form</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        _formActions: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(form)</span> {</span>
            <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>,
                api = <span class="hljs-keyword">this</span>.api(),
                models = api.models,
                fields_select = form.elem.find(<span class="hljs-string">'[name="fields"]'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-177">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-177">&#182;</a>
              </div>
              <p>When a model change, change the selction as well.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            form.elem.find(<span class="hljs-string">'[name="url"]'</span>).change(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> {</span>
                <span class="hljs-keyword">var</span> url = $(<span class="hljs-keyword">this</span>).val(),
                    model = models[url];</pre></div></div>
            
        </li>
        
        
        <li id="section-178">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-178">&#182;</a>
              </div>
              <p>there is a model</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                fields_select.val([]).trigger(<span class="hljs-string">"change"</span>);
                fields_select.children().remove();
                <span class="hljs-keyword">if</span> (model) {</pre></div></div>
            
        </li>
        
        
        <li id="section-179">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-179">&#182;</a>
              </div>
              <p>Add options</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (model.options) {
                        _(model.options).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(option)</span> {</span>
                            fields_select.append(option);
                        });
                    } <span class="hljs-keyword">else</span> {
                        model.options = [];
                        model.map = {};
                        _(models[url].fields).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(field)</span> {</span>
                            <span class="hljs-keyword">var</span> option = $(document.createElement(<span class="hljs-string">'option'</span>))
                                            .val(field.code).html(field.name);
                            model.map[field.code] = field;
                            model.options.push(option);
                            fields_select.append(option);
                        });
                    }</pre></div></div>
            
        </li>
        
        
        <li id="section-180">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-180">&#182;</a>
              </div>
              <p>The model correspoend with the current content model
selct fields accordignly</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (url === self.get(<span class="hljs-string">'url'</span>)) {
                        _(self.get(<span class="hljs-string">'fields'</span>)).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(field)</span> {</span>

                        });
                    }
                }
            }).val(<span class="hljs-keyword">this</span>.get(<span class="hljs-string">'url'</span>)).trigger(<span class="hljs-string">'change'</span>);
        },
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-181">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-181">&#182;</a>
              </div>
              <h2 id="-lux-cms-view"> Lux cms view</h2>
<p> Updates to the backend are either via a websocket or ajax requests.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> CmsView = lux.CmsView = lux.createView(<span class="hljs-string">'cms'</span>, {</pre></div></div>
            
        </li>
        
        
        <li id="section-182">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-182">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        selector: <span class="hljs-string">'.cms-page'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-183">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-183">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        defaults: {</pre></div></div>
            
        </li>
        
        
        <li id="section-184">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-184">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>            editing: <span class="hljs-literal">false</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-185">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-185">&#182;</a>
              </div>
              <p>backend url used to communicate with backend server
when updating &amp; creating content as well as when
repositioning it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            backend_url: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-186">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-186">&#182;</a>
              </div>
              <p>content url is used for AJAX retrieval of database contents</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            content_url: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-187">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-187">&#182;</a>
              </div>
              <p>icon for the button which add a new row in a grid</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            add_row_icon: <span class="hljs-string">'columns'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-188">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-188">&#182;</a>
              </div>
              <p>icon for the button which add a new block in a column</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            add_block_icon: <span class="hljs-string">'plus'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-189">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-189">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>            skin: <span class="hljs-string">'control'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-190">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-190">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>            row_control_class: <span class="hljs-string">'add-row'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-191">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-191">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>            columns: <span class="hljs-number">24</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-192">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-192">&#182;</a>
              </div>
              <p>Hart beat for websocket connections</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            hartbeat: <span class="hljs-number">5</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-193">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-193">&#182;</a>
              </div>
              <p>Options for the dialog controlling page inputs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            page: {
                collapsable: <span class="hljs-literal">true</span>,
                collapsed: <span class="hljs-literal">true</span>,
                className: <span class="hljs-string">'control'</span>,
                skin: <span class="hljs-string">'inverse'</span>,
                buttons: {
                    size: <span class="hljs-string">'default'</span>
                }
            },</pre></div></div>
            
        </li>
        
        
        <li id="section-194">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-194">&#182;</a>
              </div>
              <p>Options for the dialog controlling one grid</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            grid: {
                collapsable: <span class="hljs-literal">true</span>,
                className: <span class="hljs-string">'control'</span>,
                buttons: {
                    size: <span class="hljs-string">'default'</span>
                }
            },</pre></div></div>
            
        </li>
        
        
        <li id="section-195">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-195">&#182;</a>
              </div>
              <p>Options for the row dialog</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            row: {
                closable: <span class="hljs-literal">true</span>,
                collapsable: <span class="hljs-literal">true</span>,
                skin: <span class="hljs-string">'default'</span>,
                size: <span class="hljs-string">'mini'</span>,
                dragdrop: <span class="hljs-literal">false</span>,
                dropzone: <span class="hljs-string">'row-control'</span>
            },</pre></div></div>
            
        </li>
        
        
        <li id="section-196">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-196">&#182;</a>
              </div>
              <p>Options for the block dialog</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            block: {
                closable: <span class="hljs-literal">true</span>,
                collapsable: <span class="hljs-literal">true</span>,
                skin: <span class="hljs-string">'primary'</span>,
                size: <span class="hljs-string">'mini'</span>,
                dragdrop: <span class="hljs-literal">true</span>,
                dropzone: <span class="hljs-string">'block-control'</span>
            },</pre></div></div>
            
        </li>
        
        
        <li id="section-197">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-197">&#182;</a>
              </div>
              <p>Options for content editing dialog</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            contentedit: {
                modal: <span class="hljs-literal">true</span>,
                movable: <span class="hljs-literal">true</span>,
                fullscreen: <span class="hljs-literal">true</span>,
                autoOpen: <span class="hljs-literal">false</span>,
                width: <span class="hljs-number">600</span>,
                title: <span class="hljs-string">'Edit Content'</span>,
                fade: {duration: <span class="hljs-number">20</span>},
                closable: {destroy: <span class="hljs-literal">false</span>}
            }
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-198">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-198">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        initialise: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(options)</span> {</span>
            <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>,
                elem = self._element;</pre></div></div>
            
        </li>
        
        
        <li id="section-199">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-199">&#182;</a>
              </div>
              <p>In editing mode, set-up grids</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (options.editing) {</pre></div></div>
            
        </li>
        
        
        <li id="section-200">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-200">&#182;</a>
              </div>
              <p>self._handle_close();</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">this</span>.elem.addClass(<span class="hljs-string">'editing'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-201">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-201">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>                options.store = <span class="hljs-keyword">new</span> lux.create_store(
                    options.backend_url, {
                        hartbeat: options.hartbeat
                    });</pre></div></div>
            
        </li>
        
        
        <li id="section-202">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-202">&#182;</a>
              </div>
              <p>if (options.store.type === websocket) {
  this.backend = web.backend({store: options.store});
}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            }
            <span class="hljs-keyword">this</span>._setup_api();
            <span class="hljs-keyword">this</span>._super(options);
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-203">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-203">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        _setup_api: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> api = $(<span class="hljs-string">'html'</span>).data(<span class="hljs-string">'api'</span>);
            <span class="hljs-keyword">if</span> (!api) {
                <span class="hljs-keyword">this</span>.on_sitemap();
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
                $.ajax(api.url, {
                    dataType: <span class="hljs-string">'json'</span>,
                    success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data, status, xhr)</span> {</span>
                        self.on_sitemap(api, data);
                    },
                    error: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(jqXHR, textStatus, errorThrown)</span> {</span>
                        self.on_sitemap(api);
                    }
                });
            }
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-204">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-204">&#182;</a>
              </div>
              <p>When the api sitemap is available, this method setup the
datatable content type.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        on_sitemap: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(api, sitemap)</span> {</span>
            <span class="hljs-keyword">var</span> datatable = cms.content_type(<span class="hljs-string">'datatable'</span>);
            <span class="hljs-keyword">if</span> (datatable) {
                <span class="hljs-keyword">if</span> (api) {
                    api.sitemap = sitemap;
                }
                datatable._meta.api_info(api);
            }
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-205">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-205">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        _handle_close: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            $(window).bind(<span class="hljs-string">'beforeunload'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> {</span>
                e.preventDefault();
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            });
        }
    }, PageView);</pre></div></div>
            
        </li>
        
        
        <li id="section-206">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-206">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">return</span> cms;
});</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
